Lab09-01.exe
    PE Analysis
        # Virustotal
            44/71
            SHA-256: 6ac06dfa543dca43327d55a61d0aaed25f3c90cce791e0555e3e306d47107859

        # PEid
            Microsoft Visual C++ 6.0

        # PEview
            TimeStamp (IMAGE_FILE_HEADER): 2011/10/08 Tue 18:46:44 UTC
            Subsystem (IMAGE_OPTIONAL_HEADER): IMAGE_SUBSYSTEM_WINDOWS_CUI (cmd)
            Sections (Virtual Size / Size of Raw Data) -> No Packed
                .text: 9348/A000
                .rdata: D70/1000
                .data: 41BC/3000
        
        # Dependency Walker
            KERNEL32.DLL
                CloseHandle
                CompareStringA
                CompareStringW
                CopyFileA
                CreateFileA
                CreatePipe
                CreateProcessA
                DeleteFileA
                DuplicateHandle
                ExitProcess
                ExpandEnvironmentStringsA
                FlushFileBuffers
                FreeEnvironmentStringsA
                FreeEnvironmentStringsW
                GetACP
                GetCPInfo
                GetCommandLineA
                GetCurrentProcess
                GetEnvironmentStrings
                GetEnvironmentStringsW
                GetEnvironmentVariableA
                GetExitCodeProcess
                GetFileAttributesA
                GetFileTime
                GetFileType
                GetLastError
                GetLocalTime
                GetModuleFileNameA
                GetModuleHandleA
                GetOEMCP
                GetProcAddress
                GetShortPathNameA
                GetStartupInfoA
                GetStdHandle
                GetStringTypeA
                GetStringTypeW
                GetSystemDirectoryA
                GetSystemTime
                GetTimeZoneInformation
                GetVersion
                GetVersionExA
                HeapAlloc
                HeapCreate
                HeapDestroy
                HeapFree
                HeapReAlloc
                LCMapStringA
                LCMapStringW
                LoadLibraryA
                MultiByteToWideChar
                ReadFile
                RtlUnwind
                SetEnvironmentVariableA
                SetFilePointer
                SetFileTime
                SetHandleCount
                SetStdHandle
                Sleep
                TerminateProcess
                UnhandledExceptionFilter
                VirtualAlloc
                VirtualFree
                WaitForSingleObject
                WideCharToMultiByte
                WriteFile
            ADVAPI32.DLL
                ChangeServiceConfigA
                CloseServiceHandle
                CreateServiceA
                DeleteService
                OpenSCManagerA
                OpenServiceA
                RegCreateKeyExA
                RegDeleteValueA
                RegOpenKeyExA
                RegQueryValueExA
                RegSetValueExA
            SHELL32.DLL
                ShellExecuteA
            WS2_32.DLL

        # strings.exe (Only part of the results)
            lZ@
            Configuration
            SOFTWARE\Microsoft \XPS
            \kernel32.dll
            HTTP/1.0
            GET
            '`'`'
            `'`'`
            NOTHING
            CMD
            DOWNLOAD
            UPLOAD
            SLEEP
            cmd.exe
            >> NUL
            /c del
            ups
            http://www.practicalmalwareanalysis.com
            Manager Service
            .exe
            %SYSTEMROOT%\system32\
            k:%s h:%s p:%s per:%s
            -cc                                             // seems like argv
            -re                                             // seems like argv
            -in                                             // seems like argv
                    (((((                  H
            PST
            PDT

    Dynamic Analysis
        C:\Documents and Settings\practice\Desktop>Lab09-01.exe -in abcd
        C:\Documents and Settings\practice\Desktop>Lab09-01.exe
        C:\Documents and Settings\practice\Desktop>Lab09-01.exe -re abcd

        # RegShot (Part of results)
            C:\Documents and Settings\practice\Desktop>Lab09-01.exe -in abcd

            ----------------------------------
            Keys added:4
            ----------------------------------
            HKLM\SYSTEM\ControlSet001\Services\Lab09-01
            HKLM\SYSTEM\ControlSet001\Services\Lab09-01\Security
            HKLM\SYSTEM\CurrentControlSet\Services\Lab09-01
            HKLM\SYSTEM\CurrentControlSet\Services\Lab09-01\Security

            ----------------------------------
            Values added:14
            ----------------------------------
            HKLM\SYSTEM\ControlSet001\Services\Lab09-01\Security\Security: 01 00 14 80 90 00 00 00 9C 00 00 00 14 00 00 00 30 00 00 00 02 00 1C 00 01 00 00 00 02 80 14 00 FF 01 0F 00 01 01 00 00 00 00 00 01 00 00 00 00 02 00 60 00 04 00 00 00 00 00 14 00 FD 01 02 00 01 01 00 00 00 00 00 05 12 00 00 00 00 00 18 00 FF 01 0F 00 01 02 00 00 00 00 00 05 20 00 00 00 20 02 00 00 00 00 14 00 8D 01 02 00 01 01 00 00 00 00 00 05 0B 00 00 00 00 00 18 00 FD 01 02 00 01 02 00 00 00 00 00 05 20 00 00 00 23 02 00 00 01 01 00 00 00 00 00 05 12 00 00 00 01 01 00 00 00 00 00 05 12 00 00 00
            HKLM\SYSTEM\ControlSet001\Services\Lab09-01\Type: 0x00000020
            HKLM\SYSTEM\ControlSet001\Services\Lab09-01\Start: 0x00000002
            HKLM\SYSTEM\ControlSet001\Services\Lab09-01\ErrorControl: 0x00000001
            HKLM\SYSTEM\ControlSet001\Services\Lab09-01\ImagePath: "%SYSTEMROOT%\system32\Lab09-01.exe"
            HKLM\SYSTEM\ControlSet001\Services\Lab09-01\DisplayName: "Lab09-01 Manager Service"
            HKLM\SYSTEM\ControlSet001\Services\Lab09-01\ObjectName: "LocalSystem"
            HKLM\SYSTEM\CurrentControlSet\Services\Lab09-01\Security\Security: 01 00 14 80 90 00 00 00 9C 00 00 00 14 00 00 00 30 00 00 00 02 00 1C 00 01 00 00 00 02 80 14 00 FF 01 0F 00 01 01 00 00 00 00 00 01 00 00 00 00 02 00 60 00 04 00 00 00 00 00 14 00 FD 01 02 00 01 01 00 00 00 00 00 05 12 00 00 00 00 00 18 00 FF 01 0F 00 01 02 00 00 00 00 00 05 20 00 00 00 20 02 00 00 00 00 14 00 8D 01 02 00 01 01 00 00 00 00 00 05 0B 00 00 00 00 00 18 00 FD 01 02 00 01 02 00 00 00 00 00 05 20 00 00 00 23 02 00 00 01 01 00 00 00 00 00 05 12 00 00 00 01 01 00 00 00 00 00 05 12 00 00 00
            HKLM\SYSTEM\CurrentControlSet\Services\Lab09-01\Type: 0x00000020
            HKLM\SYSTEM\CurrentControlSet\Services\Lab09-01\Start: 0x00000002
            HKLM\SYSTEM\CurrentControlSet\Services\Lab09-01\ErrorControl: 0x00000001
            HKLM\SYSTEM\CurrentControlSet\Services\Lab09-01\ImagePath: "%SYSTEMROOT%\system32\Lab09-01.exe"
            HKLM\SYSTEM\CurrentControlSet\Services\Lab09-01\DisplayName: "Lab09-01 Manager Service"
            HKLM\SYSTEM\CurrentControlSet\Services\Lab09-01\ObjectName: "LocalSystem"

            ----------------------------------
            Values modified:1
            ----------------------------------
            HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed: 4C DE 51 0A 20 DD 32 0F B6 AD A1 6B B5 85 51 84 51 E8 6E 90 B5 A3 D5 29 7F D8 96 BA 92 EF 31 E9 63 46 BB 49 BC 86 3E B9 0D 9C E1 49 02 49 B0 F4 50 43 AB 84 81 33 1A C8 0C 42 ED E9 51 9C DB BD AC 88 E0 41 E7 E1 41 7F 51 A1 D8 6E E8 D0 3B 03
            HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed: B1 2F 56 86 3F 0A 65 76 58 83 E8 CE FB 90 7C 0C 8C B3 0A C3 A3 75 5F 06 16 9F 21 B2 DD 15 21 63 51 91 45 6F C2 29 C3 8E BE EC C2 62 C8 26 04 57 B0 8C F7 2C 23 B8 0E 0A 09 67 FA 4F 33 4F C9 46 E7 D2 F1 64 52 0A CD FB 29 AC CB EF 74 44 0A A8

        # procexp (View > Lower Pane View > DLLS / Handles)
            C:\Documents and Settings\practice\Desktop>Lab09-01.exe

            Nothing valuable.

        # procmon
            C:\Documents and Settings\practice\Desktop>Lab09-01.exe -in abcd
            
            Filter
                Process Name is Lab09-01.exe Include
                Operation is RegSetValue Include

            Result
                4:11:14.0798556 PM	Lab09-01.exe	3576	RegSetValue	HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed	SUCCESS	Type: REG_BINARY, Length: 80, Data: B1 2F 56 86 3F 0A 65 76 58 83 E8 CE FB 90 7C 0C
                4:11:14.1321095 PM	Lab09-01.exe	3576	RegSetValue	HKLM\SOFTWARE\Microsoft \XPS\Configuration	SUCCESS	Type: REG_BINARY, Length: 4,096, Data: 75 70 73 00 68 74 74 70 3A 2F 2F 77 77 77 2E 70
                
        # autoruns
            C:\Documents and Settings\practice\Desktop>Lab09-01.exe -in abcd

            Services
                HKLM\System\CurrentControlSet\Services				4/22/2020 11:10 AM
                    Lab09-01			c:\windows\system32\lab09-01.exe	10/18/2011 11:46 AM

        # ApateDNS
            C:\Documents and Settings\practice\Desktop>Lab09-01.exe

            www.practicalmalwareanalysis.com
            9A DE 01 00 00 01 00 00  00 00 00 00 0A 68 74 74            Þ···········htt
            70 3A 2F 2F 77 77 77 18  70 72 61 63 74 69 63 61            p://www·practica
            6C 6D 61 6C 77 61 72 65  61 6E 61 6C 79 73 69 73            lmalwareanalysis
            03 63 6F 6D 00 00 01 00  01 00 00                           ·com·······     

        # Wireshark
            C:\Documents and Settings\practice\Desktop>Lab09-01.exe

            GET 6b11/FrMy.Beq HTTP/1.0

        # IDA Pro
            int __cdecl main(int argc, const char **argv, const char **envp)
            {
            char v4; // [esp+10h] [ebp-181Ch]
            char v5; // [esp+410h] [ebp-141Ch]
            char v6; // [esp+810h] [ebp-101Ch]
            char v7; // [esp+C10h] [ebp-C1Ch]
            CHAR v8; // [esp+1024h] [ebp-808h]
            CHAR ServiceName; // [esp+1428h] [ebp-404h]
            const char *third_argv; // [esp+1828h] [ebp-4h]

            if ( argc == 1 )
            {
                if ( !check_regisrty() )                    // HKLM\SOFTWARE\Microsoft \XPS\Configuration
                delete_itself();
                if_service_then_execute();                  // Upload, Download, Cmd(shell), ''
            }
            else
            {
                third_argv = argv[argc - 1];
                if ( !sub_402510((int)third_argv) )                             // argv: abcd
                delete_itself();
                if ( _mbscmp((const unsigned __int8 *)argv[1], aIn) )           // -in
                {
                if ( _mbscmp((const unsigned __int8 *)argv[1], aRe) )           // -re
                {
                    if ( _mbscmp((const unsigned __int8 *)argv[1], aC_0) )      // -c
                    {
                    if ( _mbscmp((const unsigned __int8 *)argv[1], aCc) )       // -cc
                        delete_itself();
                    if ( argc != 3 )                                            // Lab09-01.exe -x abcd
                        delete_itself();
                    if ( !set_registry(&v5, 1024, &v6, 1024, &v4, 1024, &v7) )
                        printf((int)aKSHSPSPerS, (int)&v5);                     // -cc, printf config
                    }
                    else                                                        // -c, update service
                    {
                    if ( argc != 7 )                                            // Lab09-01.exe -c ups http://www.cc.com/ 80 60 abcd
                        delete_itself();
                    update_service(argv[2], argv[3], argv[4], argv[5]);
                    }
                }
                else if ( argc == 3 )                     // -re, delete service
                {
                    if ( get_path(&v8) )
                    return -1;
                    delete_service(&v8);
                }
                else
                {
                    if ( argc != 4 )
                    delete_itself();
                    delete_service(argv[2]);
                }
                }
                else if ( argc == 3 )                       // -in, install service
                {
                if ( get_path(&ServiceName) )
                    return -1;
                create_service(&ServiceName);               // copy self in %SYSTEMROOT%\\system32\\ and timestomping
                }
                else
                {
                if ( argc != 4 )
                    delete_itself();
                create_service(argv[2]);
                }
            }
            return 0;
            }

        # OllyDbg
            Not really necessary but it will help to get the useful runtime ascii string in debugging.

Analysis
    The malware copy itself into %SYSTEMROOT%\\system32\\ directory and create a service to achieve auto-start. And it will get command through accessing http://www.practicalmalwareanalysis.com/6b11/FrMy.Beq.
    
