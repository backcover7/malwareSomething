Lab12-01.exe
    PE Analysis
        # Virustotal
            53/70
            SHA-256: 1fb3c4a9109ef171fa67bdf90e67f09ef25b5a1d401dc20dc45cfccf1e4fbd99

            PEiD packer
                Microsoft Visual C++

            TimeStamp: 2011-11-05 22:28:28

            Subsystem: Windows CUI
            
            Sections
                Name	Virtual Address	Virtual Size	Raw Size	Entropy	MD5
                .text	4096	14808	16384	6.22	f294fa8daffdf0fbddb7db7eff797c62
                .rdata	20480	2130	4096	3.4	a8375616a03702072374675d1138a990
                .data	24576	10908	12288	0.48	9d4eae8ff714a1300acfcffaabb2883a

            IMPORT
                KERNEL32.dll
                    HeapFree
                    GetStdHandle
                    WriteProcessMemory
                    VirtualAllocEx
                    GetOEMCP
                    LCMapStringA
                    HeapDestroy
                    ExitProcess
                    GetEnvironmentStringsW
                    GetVersionExA
                    GetModuleFileNameA
                    RtlUnwind
                    LoadLibraryA
                    CreateRemoteThread
                    FreeEnvironmentStringsA
                    GetCurrentProcess
                    GetEnvironmentStrings
                    LCMapStringW
                    OpenProcess
                    GetCurrentDirectoryA
                    UnhandledExceptionFilter
                    MultiByteToWideChar
                    FreeEnvironmentStringsW
                    GetCPInfo
                    GetCommandLineA
                    GetProcAddress
                    WideCharToMultiByte
                    GetStringTypeA
                    GetModuleHandleA
                    lstrcatA
                    WriteFile
                    GetStartupInfoA
                    CloseHandle
                    GetACP
                    HeapReAlloc
                    GetStringTypeW
                    TerminateProcess
                    SetHandleCount
                    GetEnvironmentVariableA
                    HeapCreate
                    VirtualFree
                    GetFileType
                    HeapAlloc
                    GetVersion
                    VirtualAlloc

        # strings.exe (Only part of the results)
            kernel32.dll
            Lab12-01.dll
            psapi.dll

    Dynamic Analysis
        # RegShot (Part of results)
            ----------------------------------
            Values modified:2
            ----------------------------------
            HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed: 07 88 72 6F 24 E0 1E 57 53 19 F5 12 D2 63 CE 20 C3 82 FF 5E 78 8D 0B 44 D2 72 7E 3B 40 36 C3 3D AF 55 91 3C 30 E5 D4 63 7F 2D 22 56 61 85 2C 93 66 BF BD 90 A0 A1 64 3B E5 F3 A1 89 F0 23 81 C5 75 AE 21 F4 F3 0B 52 0A 59 9C E2 95 E6 B0 0A 1E
            HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed: 75 D1 EA 61 07 33 01 ED 66 C6 93 AA F7 53 D7 44 5E BC F4 B5 7A 28 B6 98 51 1C E9 BB 58 42 0B 2B C8 92 D0 94 99 90 54 3D F7 74 8E 4B 18 17 9E 82 10 F4 90 E9 B7 77 BE C3 04 62 7A A9 6A B2 AF 3A 6A 8B CF C6 1B 62 34 7C 45 B9 FF 1B EA E5 5B CB
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\SessionInformation\ProgramCount: 0x00000006
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\SessionInformation\ProgramCount: 0x00000007

        # procexp (View > Lower Pane View > DLLS / Handles)
            explorer.exe	explorer.exe	2.16	17,600 K	25,120 K	2620	Windows Explorer	Microsoft Corporation
                Lab12-01.dll			C:\Documents and Settings\practice\Desktop\Lab12-01.dll

        # procmon
            Nothing valuable                

        # autoruns
            NULL

        # ApateDNS
            NULL
        
        # sc
            NULL

        # IDA Pro
            int __cdecl main(int argc, const char **argv, const char **envp)
            {
            v18 = 0;
            v19 = 0;
            v20 = 0;
            v21 = 0;
            memset(&v8, 0, 0x40u);
            v17 = 0;
            psapi_dll_handler = LoadLibraryA(psapi_dll);
            EnumProcessModules_addr = GetProcAddress(psapi_dll_handler, EnumProcessModules);
            psapi_dll_handler_0 = LoadLibraryA(psapi_dll);
            GetModuleBaseNameA_addr = GetProcAddress(psapi_dll_handler_0, GetModuleBaseNameA);
            psapi_dll_handler_1 = LoadLibraryA(psapi_dll);
            EnumProcesses_addr = GetProcAddress(psapi_dll_handler_1, EnumProcesses);
            GetCurrentDirectoryA(0x104u, &Current_Directory);
            lstrcatA(&Current_Directory, String2);        // \
            lstrcatA(&Current_Directory, Lab12_01_dll);
            if ( !EnumProcesses_addr(dwProcessId, 4096, &v14) )
                return 1;
            v7 = v14 >> 2;
            for ( i = 0; i < v7; ++i )
            {
                hProcess = 0;
                if ( dwProcessId[i] )
                v17 = find_explorer_exe(dwProcessId[i]);
                if ( v17 == 1 )
                {
                hProcess = OpenProcess(0x43Au, 0, dwProcessId[i]);
                if ( hProcess == -1 )
                    return -1;
                i = 2000;
                }
            }
            lpBaseAddress = VirtualAllocEx(hProcess, 0, 0x104u, 0x3000u, 4u);
            if ( !lpBaseAddress )
                return -1;
            WriteProcessMemory(hProcess, lpBaseAddress, &Current_Directory, 0x104u, 0);// ..\Lab12-01.dll
            hModule = GetModuleHandleA(kernel32_dll);
            lpStartAddress = GetProcAddress(hModule, LoadLibraryA_0);
            v10 = CreateRemoteThread(hProcess, 0, 0, lpStartAddress, lpBaseAddress, 0, 0);
            if ( v10 )
                result = 0;
            else
                result = -1;
            return result;
            }            

            OllyDbg > File > Attach > explorer.exe > View > Memory map
                Memory map, item 116
                Address = 01780000
                Size = 00001000 (4096.)
                Owner = Lab12-01        01780000 (self)
                Section =
                Contains = PE header
                Type = Img  01001002
                Access = R
                Initial access = RWE CopyOnWr
                Mapped as =


Lab12-01.dll
    PE Analysis
        # Virustotal
            8/70
            SHA-256: 0ea89a83b84b8d20e259bacb6b0d1b176c8327f097c54749ae832981f2a0095a

            PEiD packer
                Microsoft Visual C++ v6.0 DLL

            TimeStamp: 2011-03-26 22:16:59

            Subsystem: Windows CUI
            
            Sections
                Name	Virtual Address	Virtual Size	Raw Size	Entropy	MD5
                .text	4096	21766	24576	6.15	46d8bef60edf36921019a4a99d73bee5
                .rdata	28672	3014	4096	4.34	41fa49e4e7722b41fd2fa909a0175ecc
                .data	32768	17440	12288	0.75	cd54e566bf1e9c5b082975d39a681363
                .reloc	53248	3438	4096	3.36	9c06dc0de7ab996f7d275e3f2e9e9102

            IMPORT
                KERNEL32.dll
                GetLastError
                InitializeCriticalSection
                HeapFree
                GetStdHandle
                EnterCriticalSection
                LCMapStringW
                SetHandleCount
                GetOEMCP
                LCMapStringA
                HeapDestroy
                ExitProcess
                TlsAlloc
                FlushFileBuffers
                GetEnvironmentStringsW
                GetVersionExA
                LoadLibraryA
                RtlUnwind
                GetModuleFileNameA
                FreeEnvironmentStringsA
                DeleteCriticalSection
                GetStartupInfoA
                GetEnvironmentStrings
                WideCharToMultiByte
                InterlockedDecrement
                MultiByteToWideChar
                FreeEnvironmentStringsW
                GetCPInfo
                GetCommandLineA
                GetProcAddress
                GetStringTypeA
                SetStdHandle
                SetFilePointer
                CreateThread
                TlsFree
                GetModuleHandleA
                WriteFile
                GetCurrentProcess
                CloseHandle
                GetACP
                HeapReAlloc
                GetStringTypeW
                GetCurrentThreadId
                TerminateProcess
                GetEnvironmentVariableA
                HeapCreate
                VirtualFree
                TlsGetValue
                Sleep
                GetFileType
                TlsSetValue
                HeapAlloc
                GetVersion
                InterlockedIncrement
                VirtualAlloc
                SetLastError
                LeaveCriticalSection
            USER32.dll
                MessageBoxA

        # strings.exe
            Press OK to reboot
            Practical Malware Analysis %d

    Dynamic Analysis
        # IDA Pro
            BOOL __stdcall DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved)
            {
            if ( fdwReason == 1 )
                CreateThread(0, 0, sub_10001030, 0, 0, &ThreadId);
            return 1;
            }

            void __stdcall sub_10001030(LPVOID lpThreadParameter)
            {
            for ( i = 0; ; ++i )
            {
                sprintf(&Parameter, 'Practical Malware Analysis %d', i);
                CreateThread(0, 0, StartAddress, &Parameter, 0, 0);         // MessageBoxA
                Sleep(60000u);
            }
            }

Analysis
    DLL injection into explorer.exe and alert message box per 1 min.
    


        
