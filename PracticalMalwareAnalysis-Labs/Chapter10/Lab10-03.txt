Lab10-03.exe
    PE Analysis
        # Virustotal
            38/70
            SHA-256: d66e15eea51ebd4bfd13f8c97646253740b1e6a99328d22232fd01ae13ef5d05

            PEiD packer
                Microsoft Visual C++

            TimeStamp: 2011-11-22 10:38:53

            Subsystem: Windows GUI
            
            Sections
                Name	Virtual Address	Virtual Size	Raw Size	Entropy	MD5
                .text	4096	10686	12288	6.01	ca13ae1815a149f69f0dd295f609eed9
                .rdata	16384	2260	4096	3.47	aac90c0f50f8aa2b6fddc84a3f0b4595
                .data	20480	2652	4096	1.14	bd71a2ac457763296202db5fb98acfca

            IMPORT
                ADVAPI32.dll
                    CreateServiceA
                    CloseServiceHandle
                    OpenSCManagerA
                    StartServiceA
                KERNEL32.DLL
                    DeviceIoControl
                    HeapFree
                    GetStdHandle
                    LCMapStringW
                    SetHandleCount
                    GetOEMCP
                    LCMapStringA
                    HeapDestroy
                    ExitProcess
                    GetEnvironmentStringsW
                    GetModuleFileNameA
                    RtlUnwind
                    LoadLibraryA
                    FreeEnvironmentStringsA
                    GetStartupInfoA
                    GetEnvironmentStrings
                    GetCPInfo
                    UnhandledExceptionFilter
                    MultiByteToWideChar
                    FreeEnvironmentStringsW
                    GetCommandLineA
                    GetProcAddress
                    WideCharToMultiByte
                    GetStringTypeA
                    GetModuleHandleA
                    WriteFile
                    GetCurrentProcess
                    GetACP
                    HeapReAlloc
                    GetStringTypeW
                    TerminateProcess
                    HeapCreate
                    VirtualFree
                    Sleep
                    GetFileType
                    CreateFileA
                    HeapAlloc
                    GetVersion
                    VirtualAlloc
                OLEAUT32.dll                            // COM
                    VariantInit
                    SysAllocString
                ole32.dll
                    OleUninitialize
                    CoCreateInstance
                    OleInitialize

        # strings.exe (Only part of the results)
            http://www.malwareanalysisbook.com/ad.html
            \\.\ProcHelper
            Process Helper
            C:\Windows\System32\Lab10-03.sys

    Dynamic Analysis
        # RegShot (Part of results)
            ----------------------------------
            Keys deleted:1
            ----------------------------------
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042320200424

            ----------------------------------
            Keys added:14
            ----------------------------------
            HKLM\SYSTEM\ControlSet001\Enum\Root\LEGACY_PROCESS_HELPER
            HKLM\SYSTEM\ControlSet001\Enum\Root\LEGACY_PROCESS_HELPER\0000
            HKLM\SYSTEM\ControlSet001\Enum\Root\LEGACY_PROCESS_HELPER\0000\Control
            HKLM\SYSTEM\ControlSet001\Services\Process Helper
            HKLM\SYSTEM\ControlSet001\Services\Process Helper\Security
            HKLM\SYSTEM\ControlSet001\Services\Process Helper\Enum
            HKLM\SYSTEM\CurrentControlSet\Enum\Root\LEGACY_PROCESS_HELPER
            HKLM\SYSTEM\CurrentControlSet\Enum\Root\LEGACY_PROCESS_HELPER\0000
            HKLM\SYSTEM\CurrentControlSet\Enum\Root\LEGACY_PROCESS_HELPER\0000\Control
            HKLM\SYSTEM\CurrentControlSet\Services\Process Helper
            HKLM\SYSTEM\CurrentControlSet\Services\Process Helper\Security
            HKLM\SYSTEM\CurrentControlSet\Services\Process Helper\Enum
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042020200427
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042920200430

            ----------------------------------
            Values deleted:5
            ----------------------------------
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042320200424\CachePath: "%USERPROFILE%\Local Settings\History\History.IE5\MSHist012020042320200424"
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042320200424\CachePrefix: ":2020042320200424: "
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042320200424\CacheLimit: 0x00002000
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042320200424\CacheOptions: 0x0000000B
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042320200424\CacheRepair: 0x00000000

            ----------------------------------
            Values added:48
            ----------------------------------
            HKLM\SYSTEM\ControlSet001\Enum\Root\LEGACY_PROCESS_HELPER\0000\Control\*NewlyCreated*: 0x00000000
            HKLM\SYSTEM\ControlSet001\Enum\Root\LEGACY_PROCESS_HELPER\0000\Control\ActiveService: "Process Helper"
            HKLM\SYSTEM\ControlSet001\Enum\Root\LEGACY_PROCESS_HELPER\0000\Service: "Process Helper"
            HKLM\SYSTEM\ControlSet001\Enum\Root\LEGACY_PROCESS_HELPER\0000\Legacy: 0x00000001
            HKLM\SYSTEM\ControlSet001\Enum\Root\LEGACY_PROCESS_HELPER\0000\ConfigFlags: 0x00000000
            HKLM\SYSTEM\ControlSet001\Enum\Root\LEGACY_PROCESS_HELPER\0000\Class: "LegacyDriver"
            HKLM\SYSTEM\ControlSet001\Enum\Root\LEGACY_PROCESS_HELPER\0000\ClassGUID: "{8ECC055D-047F-11D1-A537-0000F8753ED1}"
            HKLM\SYSTEM\ControlSet001\Enum\Root\LEGACY_PROCESS_HELPER\0000\DeviceDesc: "Process Helper"
            HKLM\SYSTEM\ControlSet001\Enum\Root\LEGACY_PROCESS_HELPER\NextInstance: 0x00000001
            HKLM\SYSTEM\ControlSet001\Services\Process Helper\Enum\0: "Root\LEGACY_PROCESS_HELPER\0000"
            HKLM\SYSTEM\ControlSet001\Services\Process Helper\Enum\Count: 0x00000001
            HKLM\SYSTEM\ControlSet001\Services\Process Helper\Enum\NextInstance: 0x00000001
            HKLM\SYSTEM\ControlSet001\Services\Process Helper\Security\Security: 01 00 14 80 90 00 00 00 9C 00 00 00 14 00 00 00 30 00 00 00 02 00 1C 00 01 00 00 00 02 80 14 00 FF 01 0F 00 01 01 00 00 00 00 00 01 00 00 00 00 02 00 60 00 04 00 00 00 00 00 14 00 FD 01 02 00 01 01 00 00 00 00 00 05 12 00 00 00 00 00 18 00 FF 01 0F 00 01 02 00 00 00 00 00 05 20 00 00 00 20 02 00 00 00 00 14 00 8D 01 02 00 01 01 00 00 00 00 00 05 0B 00 00 00 00 00 18 00 FD 01 02 00 01 02 00 00 00 00 00 05 20 00 00 00 23 02 00 00 01 01 00 00 00 00 00 05 12 00 00 00 01 01 00 00 00 00 00 05 12 00 00 00
            HKLM\SYSTEM\ControlSet001\Services\Process Helper\Type: 0x00000001
            HKLM\SYSTEM\ControlSet001\Services\Process Helper\Start: 0x00000003
            HKLM\SYSTEM\ControlSet001\Services\Process Helper\ErrorControl: 0x00000001
            HKLM\SYSTEM\ControlSet001\Services\Process Helper\ImagePath: "\??\C:\Windows\System32\Lab10-03.sys"
            HKLM\SYSTEM\ControlSet001\Services\Process Helper\DisplayName: "Process Helper"
            HKLM\SYSTEM\CurrentControlSet\Enum\Root\LEGACY_PROCESS_HELPER\0000\Control\*NewlyCreated*: 0x00000000
            HKLM\SYSTEM\CurrentControlSet\Enum\Root\LEGACY_PROCESS_HELPER\0000\Control\ActiveService: "Process Helper"
            HKLM\SYSTEM\CurrentControlSet\Enum\Root\LEGACY_PROCESS_HELPER\0000\Service: "Process Helper"
            HKLM\SYSTEM\CurrentControlSet\Enum\Root\LEGACY_PROCESS_HELPER\0000\Legacy: 0x00000001
            HKLM\SYSTEM\CurrentControlSet\Enum\Root\LEGACY_PROCESS_HELPER\0000\ConfigFlags: 0x00000000
            HKLM\SYSTEM\CurrentControlSet\Enum\Root\LEGACY_PROCESS_HELPER\0000\Class: "LegacyDriver"
            HKLM\SYSTEM\CurrentControlSet\Enum\Root\LEGACY_PROCESS_HELPER\0000\ClassGUID: "{8ECC055D-047F-11D1-A537-0000F8753ED1}"
            HKLM\SYSTEM\CurrentControlSet\Enum\Root\LEGACY_PROCESS_HELPER\0000\DeviceDesc: "Process Helper"
            HKLM\SYSTEM\CurrentControlSet\Enum\Root\LEGACY_PROCESS_HELPER\NextInstance: 0x00000001
            HKLM\SYSTEM\CurrentControlSet\Services\Process Helper\Enum\0: "Root\LEGACY_PROCESS_HELPER\0000"
            HKLM\SYSTEM\CurrentControlSet\Services\Process Helper\Enum\Count: 0x00000001
            HKLM\SYSTEM\CurrentControlSet\Services\Process Helper\Enum\NextInstance: 0x00000001
            HKLM\SYSTEM\CurrentControlSet\Services\Process Helper\Security\Security: 01 00 14 80 90 00 00 00 9C 00 00 00 14 00 00 00 30 00 00 00 02 00 1C 00 01 00 00 00 02 80 14 00 FF 01 0F 00 01 01 00 00 00 00 00 01 00 00 00 00 02 00 60 00 04 00 00 00 00 00 14 00 FD 01 02 00 01 01 00 00 00 00 00 05 12 00 00 00 00 00 18 00 FF 01 0F 00 01 02 00 00 00 00 00 05 20 00 00 00 20 02 00 00 00 00 14 00 8D 01 02 00 01 01 00 00 00 00 00 05 0B 00 00 00 00 00 18 00 FD 01 02 00 01 02 00 00 00 00 00 05 20 00 00 00 23 02 00 00 01 01 00 00 00 00 00 05 12 00 00 00 01 01 00 00 00 00 00 05 12 00 00 00
            HKLM\SYSTEM\CurrentControlSet\Services\Process Helper\Type: 0x00000001
            HKLM\SYSTEM\CurrentControlSet\Services\Process Helper\Start: 0x00000003
            HKLM\SYSTEM\CurrentControlSet\Services\Process Helper\ErrorControl: 0x00000001
            HKLM\SYSTEM\CurrentControlSet\Services\Process Helper\ImagePath: "\??\C:\Windows\System32\Lab10-03.sys"
            HKLM\SYSTEM\CurrentControlSet\Services\Process Helper\DisplayName: "Process Helper"
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Internet Explorer\Recovery\Active\{12EA3B83-8A90-11EA-BFD0-08002784568B}: 0x00000000
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Internet Explorer\SearchScopes\{0633EE93-D776-472f-A0FF-E1416B8B2E3A}\FaviconPath: "C:\Documents and Settings\practice\Local Settings\Application Data\Microsoft\Internet Explorer\Services\search_{0633EE93-D776-472f-A0FF-E1416B8B2E3A}.ico"
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042020200427\CachePath: "%USERPROFILE%\Local Settings\History\History.IE5\MSHist012020042020200427"
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042020200427\CachePrefix: ":2020042020200427: "
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042020200427\CacheLimit: 0x00002000
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042020200427\CacheOptions: 0x0000000B
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042020200427\CacheRepair: 0x00000000
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042920200430\CachePath: "%USERPROFILE%\Local Settings\History\History.IE5\MSHist012020042920200430"
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042920200430\CachePrefix: ":2020042920200430: "
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042920200430\CacheLimit: 0x00002000
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042920200430\CacheOptions: 0x0000000B
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\5.0\Cache\Extensible Cache\MSHist012020042920200430\CacheRepair: 0x00000000

            ----------------------------------
            Values modified:8
            ----------------------------------
            HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed: A5 EC 03 C7 7E 6C CE E0 92 AD D9 4A DA F9 B0 F9 54 64 95 85 6F 74 29 B0 C4 83 24 79 CE 95 BC 39 0B BE BD F0 D0 E5 89 9F C9 D6 7B A7 03 C8 E6 28 5D 47 ED 3B 76 C5 23 A0 A1 A3 65 EC CC CE BA B7 5D F4 E8 95 67 C4 B9 B3 13 C9 22 36 A9 7E B9 C0
            HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed: 00 5F E5 99 49 37 19 17 31 46 5A 95 52 87 93 2B 0D 6B 9F 2E 23 1E DC DA 0F 29 41 FB EE 88 64 50 35 6E C4 A9 77 A1 BD E0 BC 4D 0B F1 40 79 BD 44 DD 61 CF F0 3F AC F6 06 53 82 73 82 58 89 23 A9 95 09 16 4A 34 E5 D2 E4 92 40 0B 01 54 43 A6 BE
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Internet Explorer\Main\Window_Placement: 2C 00 00 00 00 00 00 00 01 00 00 00 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF ED 00 00 00 74 00 00 00 0D 04 00 00 CC 02 00 00
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Internet Explorer\Main\Window_Placement: 2C 00 00 00 00 00 00 00 01 00 00 00 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 0A 01 00 00 91 00 00 00 2A 04 00 00 E9 02 00 00
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Internet Explorer\Main\IE8RunOnceLastShown_TIMESTAMP: A0 22 38 57 9C 19 D6 01
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Internet Explorer\Main\IE8RunOnceLastShown_TIMESTAMP: 80 52 11 D8 9C 1E D6 01
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Explorer\MenuOrder\Favorites\Links\Order: 08 00 00 00 02 00 00 00 E0 00 00 00 01 00 00 00 02 00 00 00 68 00 00 00 00 00 00 00 5A 00 32 00 EC 00 00 00 97 50 01 93 20 00 53 55 47 47 45 53 7E 31 2E 55 52 4C 00 00 3E 00 03 00 04 00 EF BE 97 50 01 93 97 50 01 93 14 00 00 00 53 00 75 00 67 00 67 00 65 00 73 00 74 00 65 00 64 00 20 00 53 00 69 00 74 00 65 00 73 00 2E 00 75 00 72 00 6C 00 00 00 1C 00 00 00 00 00 00 00 6C 00 00 00 01 00 00 00 5E 00 32 00 E2 00 00 00 97 50 A1 0A 20 00 57 45 42 53 4C 49 7E 31 2E 55 52 4C 00 00 42 00 03 00 04 00 EF BE 97 50 A1 0A 97 50 F1 92 14 00 00 00 57 00 65 00 62 00 20 00 53 00 6C 00 69 00 63 00 65 00 20 00 47 00 61 00 6C 00 6C 00 65 00 72 00 79 00 2E 00 75 00 72 00 6C 00 00 00 1C 00 00 00 00 00 00 00
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Explorer\MenuOrder\Favorites\Links\Order: 08 00 00 00 02 00 00 00 E0 00 00 00 01 00 00 00 02 00 00 00 68 00 00 00 00 00 00 00 5A 00 32 00 EC 00 00 00 97 50 01 93 20 00 53 55 47 47 45 53 7E 31 2E 55 52 4C 00 00 3E 00 03 00 04 00 EF BE 97 50 01 93 97 50 8E A9 14 00 00 00 53 00 75 00 67 00 67 00 65 00 73 00 74 00 65 00 64 00 20 00 53 00 69 00 74 00 65 00 73 00 2E 00 75 00 72 00 6C 00 00 00 1C 00 00 00 00 00 00 00 6C 00 00 00 01 00 00 00 5E 00 32 00 E2 00 00 00 97 50 A1 0A 20 00 57 45 42 53 4C 49 7E 31 2E 55 52 4C 00 00 42 00 03 00 04 00 EF BE 97 50 A1 0A 97 50 8E A9 14 00 00 00 57 00 65 00 62 00 20 00 53 00 6C 00 69 00 63 00 65 00 20 00 47 00 61 00 6C 00 6C 00 65 00 72 00 79 00 2E 00 75 00 72 00 6C 00 00 00 1C 00 00 00 00 00 00 00
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Ext\Stats\{E2E2DD38-D088-4134-82B7-F2BA38496583}\iexplore\Count: 0x00000003
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Ext\Stats\{E2E2DD38-D088-4134-82B7-F2BA38496583}\iexplore\Count: 0x00000004
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Ext\Stats\{E2E2DD38-D088-4134-82B7-F2BA38496583}\iexplore\Time: E4 07 04 00 04 00 17 00 15 00 0C 00 12 00 06 00
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Ext\Stats\{E2E2DD38-D088-4134-82B7-F2BA38496583}\iexplore\Time: E4 07 04 00 04 00 1E 00 03 00 0A 00 00 00 3F 01
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections\SavedLegacySettings: 46 00 00 00 10 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 04 00 00 00 00 00 00 00 C0 54 DE 4C 9C 19 D6 01 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 02 00 00 00 0A 00 00 02 00 00 00 00 00 00 00 00 01 00 00 00 05 00 00 00 08 B8 16 00 60 35 18 00 00 00 00 00 10 01 00 00 FF FF FF FF 00 00 00 00 0C 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 03 A8 02 00 00 00 00 00 C0 00 00 00 00 00 00 46 40 9D 05 22 9E 7E CF 11 AE 5A 00 AA 00 A7 11 2B 6D 00 61 00 6C 00 77 00 61 00 72 00 65 00 00 00 00 00 00 00
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections\SavedLegacySettings: 46 00 00 00 15 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 04 00 00 00 00 00 00 00 C0 54 DE 4C 9C 19 D6 01 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 02 00 00 00 0A 00 00 02 00 00 00 00 00 00 00 00 01 00 00 00 05 00 00 00 08 B8 16 00 60 35 18 00 00 00 00 00 10 01 00 00 FF FF FF FF 00 00 00 00 0C 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 03 A8 02 00 00 00 00 00 C0 00 00 00 00 00 00 46 40 9D 05 22 9E 7E CF 11 AE 5A 00 AA 00 A7 11 2B 6D 00 61 00 6C 00 77 00 61 00 72 00 65 00 00 00 00 00 00 00
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\SessionInformation\ProgramCount: 0x00000006
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\SessionInformation\ProgramCount: 0x00000007

        # procexp (View > Lower Pane View > DLLS / Handles)
            IEXPLORE.EXE	IEXPLORE.EXE	0.99	14,240 K	23,292 K	2812	Internet Explorer	Microsoft Corporation
                IEXPLORE.EXE	IEXPLORE.EXE		8,320 K	15,248 K	2892	Internet Explorer	Microsoft Corporation
                IEXPLORE.EXE	IEXPLORE.EXE		8,188 K	15,588 K	2676	Internet Explorer	Microsoft Corporation
                ...

        # procmon
            Meet crash

        # autoruns
            NULL

        # ApateDNS
            www.malwareanalysisbook.com
            31 58 01 00 00 01 00 00  00 00 00 00 03 77 77 77            1X···········www
            13 6D 61 6C 77 61 72 65  61 6E 61 6C 79 73 69 73            ·malwareanalysis
            62 6F 6F 6B 03 63 6F 6D  00 00 01 00 01 00 00               book·com······· 

        # INetSim
            2020-04-29 23:13:35  DNS connection, type: A, class: IN, requested name: www.malwareanalysisbook.com
            2020-04-29 23:13:35  HTTP connection, method: GET, URL: http://www.malwareanalysisbook.com/ad.html, file name: /var/lib/inetsim/http/fakefiles/sample.html
            2020-04-29 23:14:05  HTTP connection, method: GET, URL: http://www.malwareanalysisbook.com/ad.html, file name: /var/lib/inetsim/http/fakefiles/sample.html

        # sc
            NULL

        # IDA Pro & OllyDbg & WinDbg    (.sympath srv*c:\MyServerSymbols*https://msdl.microsoft.com/download/symbols)
            int __stdcall WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nShowCmd)
            {
            v4 = OpenSCManagerA(0, 0, 0xF003Fu);
            if ( v4 )
            {
                Process_Helper_Service = CreateServiceA(
                                        v4,
                                        Process_Helper,
                                        Process_Helper,
                                        0xF01FFu,
                                        1u,              // Driver service
                                        3u,              // SERVICE_DEMAND_START
                                        1u,
                                        BinaryPathName,  // C:\Windows\System32\Lab10-03.sys
                                        0, 0, 0, 0, 0);
                Process_Helper_Service_Handler = Process_Helper_Service;
                if ( Process_Helper_Service )
                StartServiceA(Process_Helper_Service, 0, 0);
                CloseServiceHandle(Process_Helper_Service_Handler);
                File_Handler = CreateFileA(FileName, 0xC0000000, 0, 0, 2u, 0x80u, 0);// \\.\ProcHelper <- ProcHelper is a driver
                if ( File_Handler == -1 )
                return 1;
                DeviceIoControl(File_Handler, 0xABCDEF01, 0, 0, 0, 0, &BytesReturned, 0);
                if ( OleInitialize(0) >= 0 )
                {
                CoCreateInstance(&InternetExplorer, 0, 4u, &IWebBrowser2, &ppv);
                if ( ppv )
                {
                    VariantInit(&pvarg);
                    v13 = 3;
                    v14 = 1;
                    v9 = SysAllocString(http_www_malwareanalysisbook_com_ad_html);
                    while ( 1 )
                    {
                    (*(*ppv + 44))(ppv, v9, &v13, &pvarg, &pvarg, &pvarg);
                    Sleep(0x7530u);
                    }
                }
                OleUninitialize();
                }
            }
            return 0;
            }

Lab10-03.sys
    PE Analysis
        # Virustotal
            4/73
            SHA-256: 59d09b747441ed35e0fc0b5b352b4c66532f1fdd4646457a5ea972f067a55b30

            TimeStamp: 2012-01-14 11:30:50
            
            File is not signed
            
            Sections
                Name	Virtual Address	Virtual Size	Raw Size	Entropy	MD5
                .rdata	1152	190	256	3.98	62d7f60be3ae4163cd64c138ab941bc0
                .data	1408	8	128	0.52	1f558917e0b83de44fffa4db41aab932
                PAGE	1536	208	256	4.3	626dc7f15ff6a1880000dba76569807f
                INIT	1792	564	640	4.94	2a0c66a4134ec921bf05bd369e63a2b6
                .rsrc	2432	952	1024	3.26	1fe02a398eb14998994fd6fd8f9d8750
                .reloc	3456	68	128	2.25	fe6393a85ef9c917bbf116edb38d6032

        # strings.exe (Only part of the results)
            c:\winddk\7600.16385.1\src\general\rootkitprochide\wdm\sys\objfre_wxp_x86\i386\sioctl.pdb
            \DosDevices\ProcHelper
            F@h
            Fpf
            F4*
            \DosDevices\ProcHelper
            \Device\ProcHelper
            IofCompleteRequest
            IoDeleteDevice
            IoDeleteSymbolicLink
            RtlInitUnicodeString
            IoGetCurrentProcess
            IoCreateSymbolicLink
            IoCreateDevice
            KeTickCount
            ntoskrnl.exe
            VS_VERSION_INFO
            StringFileInfo
            040904B0
            CompanyName
            Windows (R) Win 7 DDK provider
            FileDescription
            Important Process Helper
            FileVersion
            6.1.7600.16385 built by: WinDDK
            InternalName
            Lab10-03.sys
            LegalCopyright
            ABC Corp.
            OriginalFilename
            Lab10-03.sys
            ProductName
            Windows (R) Win 7 DDK driver
            ProductVersion
            6.1.7600.16385
            VarFileInfo
            Translation
            696C6M6X6m6
            7>7G7R7]7d7t7

        # Resource Hacker
            Nothing valuable

Analysis
    This malware hide itself in Task Manager.    
