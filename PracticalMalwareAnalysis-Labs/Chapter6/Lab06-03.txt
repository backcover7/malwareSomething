Lab06-03.exe
    PE Analysis
        # Virustotal
            45/72
            SHA-256: 75eb05679a0a988dddf8badfc6d5996cc7e372c73e1023dde59efbaab6ece655

        # PEid
            Microsoft Visual C++ 6.0

        # PEview
            TimeStamp (IMAGE_FILE_HEADER): 2011/02/03 Thu 15:14:16 UTC
            Subsystem (IMAGE_OPTIONAL_HEADER): IMAGE_SUBSYSTEM_WINDOWS_CUI (cmd)
            Sections (Virtual Size / Size of Raw Data) -> No Packed
                .text: 4B78/5000
                .rdata: A00/1000
                .data: 3FA8/3000
        
        # Dependency Walker
            KERNEL32.DLL
                CloseHandle
                CopyFileA
                CreateDirectoryA
                DeleteFileA
                ExitProcess
                FlushFileBuffers
                FreeEnvironmentStringsA
                FreeEnvironmentStringsW
                GetACP
                GetCPInfo
                GetCommandLineA
                GetCurrentProcess
                GetEnvironmentStrings
                GetEnvironmentStringsW
                GetEnvironmentVariableA
                GetFileType
                GetLastError
                GetModuleFileNameA
                GetModuleHandleA
                GetOEMCP
                GetProcAddress
                GetStartupInfoA
                GetStdHandle
                GetStringTypeA
                GetStringTypeW
                GetVersion
                GetVersionExA
                HeapAlloc
                HeapCreate
                HeapDestroy
                HeapFree
                HeapReAlloc
                LCMapStringA
                LCMapStringW
                LoadLibraryA
                MultiByteToWideChar
                RtlUnwind
                SetFilePointer
                SetHandleCount
                SetStdHandle
                Sleep
                TerminateProcess
                UnhandledExceptionFilter
                VirtualAlloc
                VirtualFree
                WideCharToMultiByte
                WriteFile
            WININET.DLL
                InternetCloseHandle
                InternetGetConnectedState
                InternetOpenA
                InternetOpenUrlA
                InternetReadFile
            ADVAPI32.DLL
                RegOpenKeyExA
                RegSetValueExA

        # strings.exe (Only part of the results)
            Error 1.1: No Internet
            Success: Internet Connection
            Error 2.3: Fail to get command
            Error 2.2: Fail to ReadFile
            Error 2.1: Fail to OpenUrl
            http://www.practicalmalwareanalysis.com/cc.htm
            Internet Explorer 7.5/pma
            Error 3.2: Not a valid command provided
            Error 3.1: Could not set Registry value
            Malware
            Software\Microsoft\Windows\CurrentVersion\Run               // autorun
            C:\Temp\cc.exe                                              // !
            C:\Temp
            Success: Parsed command is %c

    Dynamic Analysis
        C:\Documents and Settings\practice\Desktop>Lab06-03.exe
        Success: Internet Connection
        Error 2.3: Fail to get command

        # RegShot (Part of results)
            ----------------------------------
            Values modified:2
            ----------------------------------
            HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed: 7A 14 2F AA 90 45 A4 2B 04 E2 2F A8 59 1F 54 BA B2 73 54 16 C5 93 D8 0E 07 5F 26 BC 53 9C D4 31 F9 A4 08 51 E5 9D 37 32 B4 4F 8B A6 14 E7 82 46 A9 61 D3 34 06 FE 90 EE 4B D1 C0 4B AE 24 9D 48 47 21 69 4C 8E AA D3 6E 62 90 97 35 4C 69 3A 84
            HKLM\SOFTWARE\Microsoft\Cryptography\RNG\Seed: AA 44 FB 41 50 15 70 7C 90 CF E5 6F A5 0D C2 80 23 2C C6 E1 7B 15 E4 59 D4 8D 48 52 82 90 90 2D 12 0B 59 30 39 FD BF 8F 34 D8 81 EA 31 E3 E5 38 7E 8B 76 7E 2E 77 4A 6F 30 DA A0 9B 8A 2E 28 FB E1 A7 89 A0 76 FE A2 32 4E 8C 64 60 20 97 18 8B
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections\SavedLegacySettings: 46 00 00 00 10 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 04 00 00 00 00 00 00 00 C0 54 DE 4C 9C 19 D6 01 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 02 00 00 00 0A 00 00 02 00 00 00 00 00 00 00 00 01 00 00 00 05 00 00 00 08 B8 16 00 60 35 18 00 00 00 00 00 10 01 00 00 FF FF FF FF 00 00 00 00 0C 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 03 A8 02 00 00 00 00 00 C0 00 00 00 00 00 00 46 40 9D 05 22 9E 7E CF 11 AE 5A 00 AA 00 A7 11 2B 6D 00 61 00 6C 00 77 00 61 00 72 00 65 00 00 00 00 00 00 00
            HKU\S-1-5-21-1078081533-842925246-1708537768-1003\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections\SavedLegacySettings: 46 00 00 00 12 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 04 00 00 00 00 00 00 00 C0 54 DE 4C 9C 19 D6 01 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 02 00 00 00 0A 00 00 02 00 00 00 00 00 00 00 00 01 00 00 00 05 00 00 00 08 B8 16 00 60 35 18 00 00 00 00 00 10 01 00 00 FF FF FF FF 00 00 00 00 0C 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 03 A8 02 00 00 00 00 00 C0 00 00 00 00 00 00 46 40 9D 05 22 9E 7E CF 11 AE 5A 00 AA 00 A7 11 2B 6D 00 61 00 6C 00 77 00 61 00 72 00 65 00 00 00 00 00 00 00

        # procexp (View > Lower Pane View > DLLS / Handles)
            NULL

        # procmon
            Filter
                Proces Name is Lab06-03.exe Include
                Operation is RegSetValue Include
                Operation is WriteFile Include
            Result
                1:59:44.6175910 PM	Lab06-03.exe	3624	RegSetValue	HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders\Common AppData	SUCCESS	Type: REG_SZ, Length: 106, Data: C:\Documents and Settings\All Users\Application Data
                1:59:44.7927432 PM	Lab06-03.exe	3624	RegSetValue	HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders\AppData	SUCCESS	Type: REG_SZ, Length: 104, Data: C:\Documents and Settings\practice\ApplicationData
                1:59:44.7979217 PM	Lab06-03.exe	3624	RegSetValue	HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ProxyEnable	SUCCESS	Type: REG_DWORD, Length: 4, Data: 0
                1:59:44.7982587 PM	Lab06-03.exe	3624	RegSetValue	HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections\SavedLegacySettings	SUCCESS	Type: REG_BINARY, Length: 184, Data: 46 00 00 00 11 00 00 00 01 00 00 00 00 00 00 00
                1:59:44.8120861 PM	Lab06-03.exe	3624	RegSetValue	HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\UNCAsIntranet	SUCCESS	Type: REG_DWORD, Length: 4, Data: 0
                1:59:44.8121168 PM	Lab06-03.exe	3624	RegSetValue	HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\AutoDetect	SUCCESS	Type: REG_DWORD, Length: 4, Data: 1
                1:59:44.8239102 PM	Lab06-03.exe	3624	RegSetValue	HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\UNCAsIntranet	SUCCESS	Type: REG_DWORD, Length: 4, Data: 0
                1:59:44.8239549 PM	Lab06-03.exe	3624	RegSetValue	HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\AutoDetect	SUCCESS	Type: REG_DWORD, Length: 4, Data: 1
                1:59:44.8287251 PM	Lab06-03.exe	3624	RegSetValue	HKCU\Software\Microsoft\Windows\ CurrentVersion\Internet Settings\ProxyEnable	SUCCESS	Type: REG_DWORD, Length: 4, Data: 0
                1:59:44.8291676 PM	Lab06-03.exe	3624	RegSetValue	HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections\SavedLegacySettings	SUCCESS	Type: REG_BINARY, Length: 184, Data: 46 00 00 00 12 00 00 00 01 00 00 00 00 00 00 00
                1:59:44.9904021 PM	Lab06-03.exe	3624	WriteFile	C:\Documents and Settings\practice\Local Settings\Temporary Internet Files\Content.IE5\B325A768\cc[1].htm	SUCCESS	Offset: 0, Length: 258

        # ApateDNS
            www.practicalmalwareanalysis.com
            33 CF 01 00 00 01 00 00  00 00 00 00 03 77 77 77            3Ï···········www
            18 70 72 61 63 74 69 63  61 6C 6D 61 6C 77 61 72            ·practicalmalwar
            65 61 6E 61 6C 79 73 69  73 03 63 6F 6D 00 00 01            eanalysis·com···
            00 01 00 00                                                 ···· 

        # INetSim
            2020-04-26 16:57:51  DNS connection, type: A, class: IN, requested name: www.practicalmalwareanalysis.com
            2020-04-26 16:57:51  HTTP connection, method: GET, URL: http://www.practicalmalwareanalysis.com/cc.htm, file name: /var/lib/inetsim/http/fakefiles/sample.html
            2020-04-26 16:57:55  HTTP connection, method: GET, URL: http://www.practicalmalwareanalysis.com/cc.htm, file name: /var/lib/inetsim/http/fakefiles/sample.html
        
        # IDA Pro
            sub_401130

            HTML content of cc.htm

            swicth

            CreateDirectory / CopyFile / DeleteFile / RegSetValue / Sleep

            C:\Temp\cc.exe

Analysis
    Basically, it is similar with Lab06-02.exe. However, it adds a new sub_401130 in main().
    
    void __cdecl sub_401130(char a1, LPCSTR lpExistingFileName)
    {
    HKEY phkResult; // [esp+4h] [ebp-4h]

    switch ( a1 )
    {
        case 97:                                    // a
        CreateDirectoryA(PathName, 0);
        break;
        case 98:                                    // b
        CopyFileA(lpExistingFileName, (LPCSTR)Data, 1);// C:\Temp\cc.exe
        break;
        case 99:                                    // c
        DeleteFileA((LPCSTR)Data);                // C:\Temp\cc.exe
        break;
        case 100:                                   // d
        RegOpenKeyExA(HKEY_LOCAL_MACHINE, SubKey, 0, 0xF003Fu, &phkResult);// HKLM\Software\Microsoft\Windows\CurrentVersion\Run
        if ( RegSetValueExA(phkResult, ValueName, 0, 1u, Data, 0xFu) )
            sub_401271(aError31CouldNo);
        break;
        case 101:                                   // e
        Sleep(0x186A0u);
        break;
        default:
        sub_401271(aError32NotAVal);
        break;
    }
    }
    