Lab13-02.exe
    PE Analysis
        # Virustotal
            16/70
            SHA-256: 598f21f1e6f4d5829ba8cfba19d361e09de510493df8472a605f46dbf7927030

            PEiD packer
                Microsoft Visual C++

            TimeStamp: 2011-11-08 22:44:00

            Subsystem: Windows CUI
            
            Sections
                Name	Virtual Address	Virtual Size	Raw Size	Entropy	MD5
                .text	4096	17380	20480	5.96	493adf290dd4a1c27c175dc0fa8d561a
                .rdata	24576	2572	4096	3.83	06d1710a100f7f12bd330c77e327586c
                .data	28672	7708	4096	1.23	d03581cc84988731c25ee7381198542f

            IMPORT
                GDI32.dll
                    GetObjectA
                    DeleteDC
                    SelectObject
                    GetDIBits
                    BitBlt
                    CreateCompatibleDC
                    DeleteObject
                    CreateCompatibleBitmap
                KERNEL32.dll
                    GetLastError
                    HeapFree
                    GetStdHandle
                    LCMapStringW
                    SetHandleCount
                    GlobalFree
                    GetOEMCP
                    LCMapStringA
                    HeapDestroy
                    GetTickCount
                    FlushFileBuffers
                    GetEnvironmentStringsW
                    GlobalUnlock
                    GetModuleFileNameA
                    RtlUnwind
                    LoadLibraryA
                    FreeEnvironmentStringsA
                    HeapAlloc
                    GetCurrentProcess
                    GetEnvironmentStrings
                    GetCPInfo
                    UnhandledExceptionFilter
                    MultiByteToWideChar
                    FreeEnvironmentStringsW
                    GetCommandLineA
                    GlobalLock
                    SetStdHandle
                    WideCharToMultiByte
                    GetStringTypeA
                    SetFilePointer
                    WriteFile
                    GetStartupInfoA
                    CloseHandle
                    GetACP
                    HeapReAlloc
                    GetStringTypeW
                    GetProcAddress
                    TerminateProcess
                    HeapCreate
                    GlobalAlloc
                    VirtualFree
                    Sleep
                    GetFileType
                    CreateFileA
                    ExitProcess
                    GetVersion
                    VirtualAlloc
                USER32.dll
                    GetDesktopWindow
                    ReleaseDC
                    GetSystemMetrics
                    GetDC

        # strings.exe (Only part of the results)
            temp%08x

    Dynamic Analysis
        # RegShot (Part of results)
            Nothing valuable

        # procexp (View > Lower Pane View > DLLS / Handles)
            wupdmgr.exe	wupdmgr.exe		1,512 K	5,624 K	2964

        # procmon
            Filter
                Process Name is Lab13-02.exe Include
                Operation is WriteFile Include
            
            Result
                8:53:50.9765537 PM	Lab13-02.exe	3636	WriteFile	C:\Documents and Settings\practice\Desktop\temp00829cac	SUCCESS	Offset: 0, Length: 7,488,054
                8:53:50.9771040 PM	Lab13-02.exe	3636	WriteFile	C:\$ConvertToNonresident	SUCCESS	Offset: 0, Length: 65,536, I/O Flags: Non-cached, Paging I/O, Synchronous Paging I/O
                8:53:51.0088807 PM	Lab13-02.exe	3636	WriteFile	C:\$ConvertToNonresident	SUCCESS	Offset: 65,536, Length: 65,536, I/O Flags: Non-cached, Paging I/O, Synchronous Paging I/O
                8:53:51.0093076 PM	Lab13-02.exe	3636	WriteFile	C:\$ConvertToNonresident	SUCCESS	Offset: 131,072, Length: 65,536, I/O Flags: Non-cached, Paging I/O, Synchronous Paging I/O
                8:53:51.0096316 PM	Lab13-02.exe	3636	WriteFile	C:\$ConvertToNonresident	SUCCESS	Offset: 196,608, Length: 65,536, I/O Flags: Non-cached, Paging I/O, Synchronous Paging I/O

        # autoruns
            NULL

        # ApateDNS
            NULL
        
        # INetSim
            NULL
        
        # sc
            NULL

        # IDA Pro & OllyDbg
            Search > text > xor, Find all occurrences
                .text:004012D6	sub_40128D	                xor     eax, [ebp+var_10]           // single_xor
                .text:0040171F		                        xor     eax, [esi+edx*4]
                .text:0040176F	sub_401739	                xor     edx, [ecx]                  // heavy_xor
                ...             sub_401739                  xor     ...

                sub_40181F > heavy_xor > sub_4012DD > single_xor

                sub_401851 > sub_401000(WriteFile)

                HGLOBAL sub_401851()
                {
                Buffer = 0;
                nNumberOfBytesToWrite = 0;
                getContent(&Buffer, &nNumberOfBytesToWrite);                      // looks like screenshot
                encodingWrapper(Buffer, nNumberOfBytesToWrite);                   // sub_40181F > heavy_xor
                system_time_from_start = GetTickCount();
                sprintf(&FileName, aTemp08x, system_time_from_start);             // temp%08x
                Write_Buffer_to_File(Buffer, nNumberOfBytesToWrite, &FileName);
                GlobalUnlock(Buffer);
                return GlobalFree(Buffer);
                }
            
        # Decrypt
            1. OllyDbg modify runtime code
                Modify 0040181F(Start addr of encodingWrapper) to RETN to bypass encryption.
                $ file temp00b600b3
                temp00b600b3: PC bitmap, Windows 3.x format, 1920 x 975 x 32
                modify the extension to .bmp and open.

            2. Use encodingWrapper as decodingWrapper.
                Firstly, generate a new file.
                F2 encodingWrapper, F9, F9
                Copy generated file HEX value to OllyDbg before encodingWrapper()
                (I cannot process on OllyDbg 2.0)
                

Analysis
    The malware encrypted the screenshot and saved it in the disk.